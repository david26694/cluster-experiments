
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Functions to design and run clustered experiments">
      
      
        <meta name="author" content="David Masip">
      
      
        <link rel="canonical" href="https://david26694.github.io/cluster-experiments/api/perturbator.html">
      
      
        <link rel="prev" href="washover.html">
      
      
        <link rel="next" href="../CONTRIBUTING.html">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.5">
    
    
      
        <title>Perturbators - Cluster Experiments Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,300i,400,400i,700,700i%7CUbuntu+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Ubuntu";--md-code-font:"Ubuntu Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../stylesheets/overrides.css">
    
      <link rel="stylesheet" href="../stylesheets/style.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#from-cluster_experimentsperturbator-import" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="Cluster Experiments Docs" class="md-header__button md-logo" aria-label="Cluster Experiments Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cluster Experiments Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Perturbators
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/david26694/cluster-experiments" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Cluster Experiments Docs" class="md-nav__button md-logo" aria-label="Cluster Experiments Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Cluster Experiments Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/david26694/cluster-experiments" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Quickstart
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../normal_power_lines.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Power Analysis Guide
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Basic Usage
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Basic Usage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/simple_ab_test.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Simple A/B Test Example
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../experiment_analysis.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Experiment Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../aa_test.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AA Test (Clustered)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../relative.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Relative Lift Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    End-to-End Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            End-to-End Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../e2e_mde.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    End-to-end: Power Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../e2e_mde_switchback.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    End-to-end: Switchback Design
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../e2e_mde_delta.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    End-to-end: Delta Method
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Analysis Methods
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Analysis Methods
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../analysis_with_different_hypotheses.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Power comparison under different hypotheses
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../paired_ttest.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Paired T-Test
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../delta_method.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Delta Method Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Variance Reduction
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Variance Reduction
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cupac_example.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CUPAC Example
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Cluster Experiments
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            Cluster Experiments
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/cluster_randomization.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cluster Randomization Example
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Switchback Experiments
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            Switchback Experiments
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../switchback.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Stratified Switchback
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plot_calendars.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Calendar Visualization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plot_calendars_hours.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4-Hour Switches
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../washover_example.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Washover Example
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" >
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Power Analysis
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            Power Analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../normal_power.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Normal Power Comparison
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../normal_power_lines.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Power Analysis Guide
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8" >
        
          
          <label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Advanced Topics
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            Advanced Topics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multivariate.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multiple Treatments
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../synthetic_control.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Synthetic Control
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../create_custom_classes.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom Classes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Experiment Analysis
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Experiment Analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="analysis_plan.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Analysis Plan
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="analysis_results.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Analysis Results
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="experiment_analysis.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Experiment Analysis Methods
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="hypothesis_test.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hypothesis Test
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Metrics & Variants
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Metrics & Variants
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="metric.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Metric
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="variant.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Variant
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="dimension.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dimension
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Power Analysis
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Power Analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="power_analysis.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Power Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="power_config.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Power Config
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Randomization
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Randomization
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="random_splitter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Splitters
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Variance Reduction
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            Variance Reduction
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="cupac_model.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CUPAC Model
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6" >
        
          
          <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Switchback
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            Switchback
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="washover.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Washover
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Perturbators
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="perturbator.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Perturbators
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator" class="md-nav__link">
    <span class="md-ellipsis">
      perturbator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BetaRelativePerturbator" class="md-nav__link">
    <span class="md-ellipsis">
      BetaRelativePerturbator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BetaRelativePerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BetaRelativePerturbator._reduce_variance_beta_params" class="md-nav__link">
    <span class="md-ellipsis">
      _reduce_variance_beta_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BetaRelativePerturbator.from_config" class="md-nav__link">
    <span class="md-ellipsis">
      from_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BetaRelativePerturbator.perturbate" class="md-nav__link">
    <span class="md-ellipsis">
      perturbate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BetaRelativePositivePerturbator" class="md-nav__link">
    <span class="md-ellipsis">
      BetaRelativePositivePerturbator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BetaRelativePositivePerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BetaRelativePositivePerturbator.perturbate" class="md-nav__link">
    <span class="md-ellipsis">
      perturbate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BinaryPerturbator" class="md-nav__link">
    <span class="md-ellipsis">
      BinaryPerturbator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BinaryPerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BinaryPerturbator._data_checks" class="md-nav__link">
    <span class="md-ellipsis">
      _data_checks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BinaryPerturbator._sample_max" class="md-nav__link">
    <span class="md-ellipsis">
      _sample_max
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BinaryPerturbator.perturbate" class="md-nav__link">
    <span class="md-ellipsis">
      perturbate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.ConstantPerturbator" class="md-nav__link">
    <span class="md-ellipsis">
      ConstantPerturbator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ConstantPerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.ConstantPerturbator.perturbate" class="md-nav__link">
    <span class="md-ellipsis">
      perturbate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.NormalPerturbator" class="md-nav__link">
    <span class="md-ellipsis">
      NormalPerturbator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NormalPerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.NormalPerturbator.from_config" class="md-nav__link">
    <span class="md-ellipsis">
      from_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.NormalPerturbator.get_number_of_treated" class="md-nav__link">
    <span class="md-ellipsis">
      get_number_of_treated
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.NormalPerturbator.get_scale" class="md-nav__link">
    <span class="md-ellipsis">
      get_scale
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.NormalPerturbator.perturbate" class="md-nav__link">
    <span class="md-ellipsis">
      perturbate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.Perturbator" class="md-nav__link">
    <span class="md-ellipsis">
      Perturbator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Perturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.Perturbator.from_config" class="md-nav__link">
    <span class="md-ellipsis">
      from_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.Perturbator.perturbate" class="md-nav__link">
    <span class="md-ellipsis">
      perturbate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.RelativeMixedPerturbator" class="md-nav__link">
    <span class="md-ellipsis">
      RelativeMixedPerturbator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RelativeMixedPerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.RelativeMixedPerturbator.apply_multiplicative_effect" class="md-nav__link">
    <span class="md-ellipsis">
      apply_multiplicative_effect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.RelativeMixedPerturbator.perturbate" class="md-nav__link">
    <span class="md-ellipsis">
      perturbate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.RelativePositivePerturbator" class="md-nav__link">
    <span class="md-ellipsis">
      RelativePositivePerturbator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RelativePositivePerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.RelativePositivePerturbator.perturbate" class="md-nav__link">
    <span class="md-ellipsis">
      perturbate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.SegmentedBetaRelativePerturbator" class="md-nav__link">
    <span class="md-ellipsis">
      SegmentedBetaRelativePerturbator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SegmentedBetaRelativePerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.SegmentedBetaRelativePerturbator.from_config" class="md-nav__link">
    <span class="md-ellipsis">
      from_config
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.UniformPerturbator" class="md-nav__link">
    <span class="md-ellipsis">
      UniformPerturbator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UniformPerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.UniformPerturbator.perturbate" class="md-nav__link">
    <span class="md-ellipsis">
      perturbate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../CONTRIBUTING.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../license.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    License
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator" class="md-nav__link">
    <span class="md-ellipsis">
      perturbator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BetaRelativePerturbator" class="md-nav__link">
    <span class="md-ellipsis">
      BetaRelativePerturbator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BetaRelativePerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BetaRelativePerturbator._reduce_variance_beta_params" class="md-nav__link">
    <span class="md-ellipsis">
      _reduce_variance_beta_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BetaRelativePerturbator.from_config" class="md-nav__link">
    <span class="md-ellipsis">
      from_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BetaRelativePerturbator.perturbate" class="md-nav__link">
    <span class="md-ellipsis">
      perturbate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BetaRelativePositivePerturbator" class="md-nav__link">
    <span class="md-ellipsis">
      BetaRelativePositivePerturbator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BetaRelativePositivePerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BetaRelativePositivePerturbator.perturbate" class="md-nav__link">
    <span class="md-ellipsis">
      perturbate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BinaryPerturbator" class="md-nav__link">
    <span class="md-ellipsis">
      BinaryPerturbator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BinaryPerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BinaryPerturbator._data_checks" class="md-nav__link">
    <span class="md-ellipsis">
      _data_checks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BinaryPerturbator._sample_max" class="md-nav__link">
    <span class="md-ellipsis">
      _sample_max
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.BinaryPerturbator.perturbate" class="md-nav__link">
    <span class="md-ellipsis">
      perturbate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.ConstantPerturbator" class="md-nav__link">
    <span class="md-ellipsis">
      ConstantPerturbator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ConstantPerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.ConstantPerturbator.perturbate" class="md-nav__link">
    <span class="md-ellipsis">
      perturbate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.NormalPerturbator" class="md-nav__link">
    <span class="md-ellipsis">
      NormalPerturbator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NormalPerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.NormalPerturbator.from_config" class="md-nav__link">
    <span class="md-ellipsis">
      from_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.NormalPerturbator.get_number_of_treated" class="md-nav__link">
    <span class="md-ellipsis">
      get_number_of_treated
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.NormalPerturbator.get_scale" class="md-nav__link">
    <span class="md-ellipsis">
      get_scale
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.NormalPerturbator.perturbate" class="md-nav__link">
    <span class="md-ellipsis">
      perturbate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.Perturbator" class="md-nav__link">
    <span class="md-ellipsis">
      Perturbator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Perturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.Perturbator.from_config" class="md-nav__link">
    <span class="md-ellipsis">
      from_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.Perturbator.perturbate" class="md-nav__link">
    <span class="md-ellipsis">
      perturbate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.RelativeMixedPerturbator" class="md-nav__link">
    <span class="md-ellipsis">
      RelativeMixedPerturbator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RelativeMixedPerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.RelativeMixedPerturbator.apply_multiplicative_effect" class="md-nav__link">
    <span class="md-ellipsis">
      apply_multiplicative_effect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.RelativeMixedPerturbator.perturbate" class="md-nav__link">
    <span class="md-ellipsis">
      perturbate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.RelativePositivePerturbator" class="md-nav__link">
    <span class="md-ellipsis">
      RelativePositivePerturbator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RelativePositivePerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.RelativePositivePerturbator.perturbate" class="md-nav__link">
    <span class="md-ellipsis">
      perturbate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.SegmentedBetaRelativePerturbator" class="md-nav__link">
    <span class="md-ellipsis">
      SegmentedBetaRelativePerturbator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SegmentedBetaRelativePerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.SegmentedBetaRelativePerturbator.from_config" class="md-nav__link">
    <span class="md-ellipsis">
      from_config
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.UniformPerturbator" class="md-nav__link">
    <span class="md-ellipsis">
      UniformPerturbator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UniformPerturbator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.perturbator.UniformPerturbator.perturbate" class="md-nav__link">
    <span class="md-ellipsis">
      perturbate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="from-cluster_experimentsperturbator-import"><code>from cluster_experiments.perturbator import *</code><a class="headerlink" href="#from-cluster_experimentsperturbator-import" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">



<a id="cluster_experiments.perturbator"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="cluster_experiments.perturbator.BetaRelativePerturbator" class="doc doc-heading">
            <code>BetaRelativePerturbator</code>


<a href="#cluster_experiments.perturbator.BetaRelativePerturbator" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="cluster_experiments.perturbator.NormalPerturbator" href="#cluster_experiments.perturbator.NormalPerturbator">NormalPerturbator</a></code>, <code><a class="autorefs autorefs-internal" title="cluster_experiments.perturbator.RelativePositivePerturbator" href="#cluster_experiments.perturbator.RelativePositivePerturbator">RelativePositivePerturbator</a></code></p>


        <p>A stochastic Perturbator for continuous targets that applies a  sampled
effect from a scaled Beta distribution. It applies the effect multiplicatively.</p>
<p>The sampled effect is defined for values in the specified range
(range_min, range_max). It's recommended to set -1&lt;range_min&lt;0 and
range_max&gt;0 in a "symmetric way" around 0, such that
log(1 + range_min) = -log(1 + range_max).
This ensures to have an "symmetric range" of perturbations that relatively
decrease the target as perturbations that relatively increase the target.
By "symmetry" of relative effects we mean that for an effect c &gt; 0, an
increase of the target t via t*(1 + c) is "symmetric" to a decrease of t
via t/(1 + c). For example, an increase of 5x (i.e. by +400%, corresponding
to c_inc=4) is "symmetric" to a decrease of 5x (i.e. a decrease of -80%,
corresponding to c_dec = -0.8). In this case, 1 + c_dec = 1/(1 + c_inc), so
the relative effects c_inc and c_dec are "symmetric" in the sense that they
are inverse to each other.</p>
<p>The number of samples with 0 as target remains unchanged.</p>
<p>The stochastic effect is sampled from a beta distribution with parameters
mean and variance, which is linearly scaled to the range
(range_min, range_max).
If variance is not provided, the variance is abs(mean).</p>
<div class="highlight"><pre><span></span><code>target -&gt; target * (1 + effect), where effect ~ Beta(a, b)
</code></pre></div>
<p>The common beta parameters are derived from the mean and scale parameters,
combined with linear transformations to ensure the support in the given
range. The resulting beta parameters are scaled by abs(mu) to narrow the
beta distribution around the mean.</p>
<div class="highlight"><pre><span></span><code>mu_transformed &lt;- (mu - range_min) / (range_max - range_min)
scale_transformed &lt;- (scale - range_min) / (range_max - range_min)
a &lt;- mu_transformed / (scale_transformed * scale_transformed)
b &lt;- (1-mu_transformed) / (scale_transformed * scale_transformed)
effect_transformed ~ beta(a/abs(mu), b/abs(mu))
effect = effect_transformed * (range_max - range_min) + range_min
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>average_effect</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the average effect of the treatment. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the target_col to use as the outcome. Defaults to "target".</p>
              </div>
            </td>
            <td>
                  <code>&#39;target&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>treatment_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the name of the column that contains the treatment. Defaults to "treatment".</p>
              </div>
            </td>
            <td>
                  <code>&#39;treatment&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>treatment</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the treatment to use as the treated group. Defaults to "B".</p>
              </div>
            </td>
            <td>
                  <code>&#39;B&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scale</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the scale of the effect distribution. Defaults to None.
If not provided, the variance of the beta distribution is abs(mean).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>range_min</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the minimum value of the target range, must be &gt;-1.
Defaults to -0.8, which allows for up to 5x decreases of the target.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>range_max</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the maximum value of the target range.
Defaults to 4, which allows for up to 5x increases of the target.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>reduce_variance</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="bool">bool</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if True and if abs(average_effect)&lt;1, we reduce
the variance of the beta distribution by multiplying the beta parameters by 1/abs(average_effect).
Defaults to None, which is equivalent to True.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BetaRelativePerturbator</span><span class="p">(</span><span class="n">NormalPerturbator</span><span class="p">,</span> <span class="n">RelativePositivePerturbator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A stochastic Perturbator for continuous targets that applies a  sampled</span>
<span class="sd">    effect from a scaled Beta distribution. It applies the effect multiplicatively.</span>

<span class="sd">    The sampled effect is defined for values in the specified range</span>
<span class="sd">    (range_min, range_max). It&#39;s recommended to set -1&lt;range_min&lt;0 and</span>
<span class="sd">    range_max&gt;0 in a &quot;symmetric way&quot; around 0, such that</span>
<span class="sd">    log(1 + range_min) = -log(1 + range_max).</span>
<span class="sd">    This ensures to have an &quot;symmetric range&quot; of perturbations that relatively</span>
<span class="sd">    decrease the target as perturbations that relatively increase the target.</span>
<span class="sd">    By &quot;symmetry&quot; of relative effects we mean that for an effect c &gt; 0, an</span>
<span class="sd">    increase of the target t via t*(1 + c) is &quot;symmetric&quot; to a decrease of t</span>
<span class="sd">    via t/(1 + c). For example, an increase of 5x (i.e. by +400%, corresponding</span>
<span class="sd">    to c_inc=4) is &quot;symmetric&quot; to a decrease of 5x (i.e. a decrease of -80%,</span>
<span class="sd">    corresponding to c_dec = -0.8). In this case, 1 + c_dec = 1/(1 + c_inc), so</span>
<span class="sd">    the relative effects c_inc and c_dec are &quot;symmetric&quot; in the sense that they</span>
<span class="sd">    are inverse to each other.</span>

<span class="sd">    The number of samples with 0 as target remains unchanged.</span>

<span class="sd">    The stochastic effect is sampled from a beta distribution with parameters</span>
<span class="sd">    mean and variance, which is linearly scaled to the range</span>
<span class="sd">    (range_min, range_max).</span>
<span class="sd">    If variance is not provided, the variance is abs(mean).</span>

<span class="sd">    ```</span>
<span class="sd">    target -&gt; target * (1 + effect), where effect ~ Beta(a, b)</span>
<span class="sd">    ```</span>

<span class="sd">    The common beta parameters are derived from the mean and scale parameters,</span>
<span class="sd">    combined with linear transformations to ensure the support in the given</span>
<span class="sd">    range. The resulting beta parameters are scaled by abs(mu) to narrow the</span>
<span class="sd">    beta distribution around the mean.</span>

<span class="sd">    ```</span>
<span class="sd">    mu_transformed &lt;- (mu - range_min) / (range_max - range_min)</span>
<span class="sd">    scale_transformed &lt;- (scale - range_min) / (range_max - range_min)</span>
<span class="sd">    a &lt;- mu_transformed / (scale_transformed * scale_transformed)</span>
<span class="sd">    b &lt;- (1-mu_transformed) / (scale_transformed * scale_transformed)</span>
<span class="sd">    effect_transformed ~ beta(a/abs(mu), b/abs(mu))</span>
<span class="sd">    effect = effect_transformed * (range_max - range_min) + range_min</span>
<span class="sd">    ```</span>

<span class="sd">    Arguments:</span>
<span class="sd">        average_effect (Optional[float], optional): the average effect of the treatment. Defaults to None.</span>
<span class="sd">        target_col (str, optional): name of the target_col to use as the outcome. Defaults to &quot;target&quot;.</span>
<span class="sd">        treatment_col (str, optional): the name of the column that contains the treatment. Defaults to &quot;treatment&quot;.</span>
<span class="sd">        treatment (str, optional): name of the treatment to use as the treated group. Defaults to &quot;B&quot;.</span>
<span class="sd">        scale (Optional[float], optional): the scale of the effect distribution. Defaults to None.</span>
<span class="sd">            If not provided, the variance of the beta distribution is abs(mean).</span>
<span class="sd">        range_min (float, optional): the minimum value of the target range, must be &gt;-1.</span>
<span class="sd">            Defaults to -0.8, which allows for up to 5x decreases of the target.</span>
<span class="sd">        range_max (float, optional): the maximum value of the target range.</span>
<span class="sd">            Defaults to 4, which allows for up to 5x increases of the target.</span>
<span class="sd">        reduce_variance (Optional[bool], optional): if True and if abs(average_effect)&lt;1, we reduce</span>
<span class="sd">            the variance of the beta distribution by multiplying the beta parameters by 1/abs(average_effect).</span>
<span class="sd">            Defaults to None, which is equivalent to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;target&quot;</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;treatment&quot;</span><span class="p">,</span>
        <span class="n">treatment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span>
        <span class="n">scale</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">range_min</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">range_max</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">reduce_variance</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_range</span><span class="p">(</span><span class="n">range_min</span><span class="p">,</span> <span class="n">range_max</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">treatment_col</span><span class="p">,</span> <span class="n">treatment</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_range_min</span> <span class="o">=</span> <span class="n">range_min</span> <span class="ow">or</span> <span class="o">-</span><span class="mf">0.8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_range_max</span> <span class="o">=</span> <span class="n">range_max</span> <span class="ow">or</span> <span class="mi">4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_variance</span> <span class="o">=</span> <span class="n">reduce_variance</span> <span class="ow">or</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">perturbate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Usage:</span>
<span class="sd">        ```python</span>
<span class="sd">        from cluster_experiments.perturbator import BetaRelativePerturbator</span>
<span class="sd">        import pandas as pd</span>
<span class="sd">        df = pd.DataFrame({&quot;target&quot;: [1, 2, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">        perturbator = BetaRelativePerturbator(range_min = -0.5, range_max = 2)</span>
<span class="sd">        # Increase target metric by 20% on average</span>
<span class="sd">        perturbator.perturbate(df, average_effect=0.2)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">average_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_relative_effect_bounds</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scale</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_relative_effect_bounds</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_treated</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">sampled_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample_scaled_beta_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_multiplicative_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">sampled_effect</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_check_range</span><span class="p">(</span><span class="n">range_min</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">range_max</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">range_min</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;range_min needs to be greater than -1, got </span><span class="si">{</span><span class="n">range_min</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">range_min</span> <span class="o">&gt;=</span> <span class="n">range_max</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;range_min needs to be smaller than range_max, got &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">range_min</span><span class="w"> </span><span class="si">= }</span><span class="s2"> and </span><span class="si">{</span><span class="n">range_max</span><span class="w"> </span><span class="si">= }</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_relative_effect_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_average_effect_greater_than</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_range_min</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_average_effect_smaller_than</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_range_max</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_average_effect_greater_than</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NoReturn</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">average_effect</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Simulated effect needs to be greater than range_min=</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">, got </span><span class="si">{</span><span class="n">average_effect</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_average_effect_smaller_than</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NoReturn</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">average_effect</span> <span class="o">&gt;=</span> <span class="n">x</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Simulated effect needs to be smaller than range_max=</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">, got </span><span class="si">{</span><span class="n">average_effect</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_reduce_variance_beta_params</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Multiplying the parameters of the beta distribution with a factor &gt;1</span>
<span class="sd">        reduces variance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">*=</span> <span class="mi">1</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">*=</span> <span class="mi">1</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_sample_scaled_beta_effect</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">average_effect_inv_transf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inv_transform_to_range</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
        <span class="n">scale_inv_transf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inv_transform_to_range</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">average_effect_inv_transf</span> <span class="o">/</span> <span class="p">(</span><span class="n">scale_inv_transf</span> <span class="o">*</span> <span class="n">scale_inv_transf</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">average_effect_inv_transf</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">scale_inv_transf</span> <span class="o">*</span> <span class="n">scale_inv_transf</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_variance</span><span class="p">:</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_variance_beta_params</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_to_range</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_transform_to_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]):</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_range_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_range_min</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_range_min</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_inv_transform_to_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_range_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_range_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_range_min</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a Perturbator object from a PowerConfig object&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">average_effect</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">average_effect</span><span class="p">,</span>
            <span class="n">target_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">target_col</span><span class="p">,</span>
            <span class="n">treatment_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">,</span>
            <span class="n">treatment</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment</span><span class="p">,</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span>
            <span class="n">range_min</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">range_min</span><span class="p">,</span>
            <span class="n">range_max</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">range_max</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.perturbator.BetaRelativePerturbator._reduce_variance_beta_params" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_reduce_variance_beta_params</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span></code>

<a href="#cluster_experiments.perturbator.BetaRelativePerturbator._reduce_variance_beta_params" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Multiplying the parameters of the beta distribution with a factor &gt;1
reduces variance</p>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_reduce_variance_beta_params</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Multiplying the parameters of the beta distribution with a factor &gt;1</span>
<span class="sd">    reduces variance</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">*=</span> <span class="mi">1</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">*=</span> <span class="mi">1</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.perturbator.BetaRelativePerturbator.from_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#cluster_experiments.perturbator.BetaRelativePerturbator.from_config" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Creates a Perturbator object from a PowerConfig object</p>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a Perturbator object from a PowerConfig object&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">average_effect</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">average_effect</span><span class="p">,</span>
        <span class="n">target_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">target_col</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">,</span>
        <span class="n">treatment</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment</span><span class="p">,</span>
        <span class="n">scale</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span>
        <span class="n">range_min</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">range_min</span><span class="p">,</span>
        <span class="n">range_max</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">range_max</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.perturbator.BetaRelativePerturbator.perturbate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">perturbate</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#cluster_experiments.perturbator.BetaRelativePerturbator.perturbate" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Usage:
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">cluster_experiments.perturbator</span><span class="w"> </span><span class="kn">import</span> <span class="n">BetaRelativePerturbator</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;treatment&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">]})</span>
<span class="n">perturbator</span> <span class="o">=</span> <span class="n">BetaRelativePerturbator</span><span class="p">(</span><span class="n">range_min</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">range_max</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="c1"># Increase target metric by 20% on average</span>
<span class="n">perturbator</span><span class="o">.</span><span class="n">perturbate</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</code></pre></div></p>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">perturbate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Usage:</span>
<span class="sd">    ```python</span>
<span class="sd">    from cluster_experiments.perturbator import BetaRelativePerturbator</span>
<span class="sd">    import pandas as pd</span>
<span class="sd">    df = pd.DataFrame({&quot;target&quot;: [1, 2, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">    perturbator = BetaRelativePerturbator(range_min = -0.5, range_max = 2)</span>
<span class="sd">    # Increase target metric by 20% on average</span>
<span class="sd">    perturbator.perturbate(df, average_effect=0.2)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">average_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">check_relative_effect_bounds</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scale</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">check_relative_effect_bounds</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_treated</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">sampled_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample_scaled_beta_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_multiplicative_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">sampled_effect</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cluster_experiments.perturbator.BetaRelativePositivePerturbator" class="doc doc-heading">
            <code>BetaRelativePositivePerturbator</code>


<a href="#cluster_experiments.perturbator.BetaRelativePositivePerturbator" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="cluster_experiments.perturbator.NormalPerturbator" href="#cluster_experiments.perturbator.NormalPerturbator">NormalPerturbator</a></code>, <code><a class="autorefs autorefs-internal" title="cluster_experiments.perturbator.RelativePositivePerturbator" href="#cluster_experiments.perturbator.RelativePositivePerturbator">RelativePositivePerturbator</a></code></p>


        <p>A stochastic Perturbator for continuous, positively-defined targets that applies a
sampled effect from the Beta distribution. It applies the effect multiplicatively.</p>
<p><em>WARNING</em>: the average effect is only defined for values between 0 and 1 (not
included). Therefore, it only increments the target for the treated samples.</p>
<p>The number of samples with 0 as target remains unchanged.</p>
<p>The stochastic effect is sampled from a beta distribution with parameters mean and
variance. If variance is not provided, the variance is abs(mean). Hence, the effect
is bounded by 0 and 1.</p>
<div class="highlight"><pre><span></span><code>target -&gt; target * (1 + effect), where effect ~ Beta(a, b); a, b &gt; 0
                                   and target &gt; 0 for all samples
</code></pre></div>
<p>The common beta parameters are derived from the mean and scale parameters (see
how below). That's why the average effect is only defined for values between 0
and 1, otherwise one of the beta parameters would be negative or zero:</p>
<p><div class="highlight"><pre><span></span><code>a &lt;- mu / (scale * scale)
b &lt;- (1-mu) / (scale * scale)
effect ~ beta(a, b)
</code></pre></div>
source: https://stackoverflow.com/a/51143208</p>
<p>Example: a mean = 0.2 and variance = 0.1, give a = 20 and b = 80
Plot: https://www.wolframalpha.com/input?i=plot+distribution+of+beta%2820%2C+80%29</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>average_effect</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the average effect of the treatment. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the target_col to use as the outcome. Defaults to "target".</p>
              </div>
            </td>
            <td>
                  <code>&#39;target&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>treatment_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the name of the column that contains the treatment. Defaults to "treatment".</p>
              </div>
            </td>
            <td>
                  <code>&#39;treatment&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>treatment</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the treatment to use as the treated group. Defaults to "B".</p>
              </div>
            </td>
            <td>
                  <code>&#39;B&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scale</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the scale of the effect distribution. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BetaRelativePositivePerturbator</span><span class="p">(</span><span class="n">NormalPerturbator</span><span class="p">,</span> <span class="n">RelativePositivePerturbator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A stochastic Perturbator for continuous, positively-defined targets that applies a</span>
<span class="sd">    sampled effect from the Beta distribution. It applies the effect multiplicatively.</span>

<span class="sd">    *WARNING*: the average effect is only defined for values between 0 and 1 (not</span>
<span class="sd">    included). Therefore, it only increments the target for the treated samples.</span>

<span class="sd">    The number of samples with 0 as target remains unchanged.</span>

<span class="sd">    The stochastic effect is sampled from a beta distribution with parameters mean and</span>
<span class="sd">    variance. If variance is not provided, the variance is abs(mean). Hence, the effect</span>
<span class="sd">    is bounded by 0 and 1.</span>

<span class="sd">    ```</span>
<span class="sd">    target -&gt; target * (1 + effect), where effect ~ Beta(a, b); a, b &gt; 0</span>
<span class="sd">                                       and target &gt; 0 for all samples</span>
<span class="sd">    ```</span>

<span class="sd">    The common beta parameters are derived from the mean and scale parameters (see</span>
<span class="sd">    how below). That&#39;s why the average effect is only defined for values between 0</span>
<span class="sd">    and 1, otherwise one of the beta parameters would be negative or zero:</span>

<span class="sd">    ```</span>
<span class="sd">    a &lt;- mu / (scale * scale)</span>
<span class="sd">    b &lt;- (1-mu) / (scale * scale)</span>
<span class="sd">    effect ~ beta(a, b)</span>
<span class="sd">    ```</span>
<span class="sd">    source: https://stackoverflow.com/a/51143208</span>

<span class="sd">    Example: a mean = 0.2 and variance = 0.1, give a = 20 and b = 80</span>
<span class="sd">    Plot: https://www.wolframalpha.com/input?i=plot+distribution+of+beta%2820%2C+80%29</span>

<span class="sd">    Arguments:</span>
<span class="sd">        average_effect (Optional[float], optional): the average effect of the treatment. Defaults to None.</span>
<span class="sd">        target_col (str, optional): name of the target_col to use as the outcome. Defaults to &quot;target&quot;.</span>
<span class="sd">        treatment_col (str, optional): the name of the column that contains the treatment. Defaults to &quot;treatment&quot;.</span>
<span class="sd">        treatment (str, optional): name of the treatment to use as the treated group. Defaults to &quot;B&quot;.</span>
<span class="sd">        scale (Optional[float], optional): the scale of the effect distribution. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">perturbate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Usage:</span>
<span class="sd">        ```python</span>
<span class="sd">        from cluster_experiments.perturbator import BetaRelativePositivePerturbator</span>
<span class="sd">        import pandas as pd</span>
<span class="sd">        df = pd.DataFrame({&quot;target&quot;: [1, 2, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">        perturbator = BetaRelativePositivePerturbator()</span>
<span class="sd">        # Increase target metric by 20%</span>
<span class="sd">        perturbator.perturbate(df, average_effect=0.2)</span>
<span class="sd">        # returns pd.DataFrame({&quot;target&quot;: [1, 3, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">average_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_beta_positive_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">)</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scale</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_treated</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">sampled_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample_beta_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_multiplicative_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">sampled_effect</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_beta_positive_effect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_average_effect_greater_than</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_average_effect_less_than</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_target_is_not_negative</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_target_is_not_constant_zero</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_average_effect_less_than</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NoReturn</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">average_effect</span> <span class="o">&gt;=</span> <span class="n">x</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Simulated effect needs to be less than </span><span class="si">{</span><span class="n">x</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">%, got &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">average_effect</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_sample_beta_effect</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">average_effect</span> <span class="o">/</span> <span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">average_effect</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.perturbator.BetaRelativePositivePerturbator.perturbate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">perturbate</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#cluster_experiments.perturbator.BetaRelativePositivePerturbator.perturbate" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Usage:
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">cluster_experiments.perturbator</span><span class="w"> </span><span class="kn">import</span> <span class="n">BetaRelativePositivePerturbator</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;treatment&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">]})</span>
<span class="n">perturbator</span> <span class="o">=</span> <span class="n">BetaRelativePositivePerturbator</span><span class="p">()</span>
<span class="c1"># Increase target metric by 20%</span>
<span class="n">perturbator</span><span class="o">.</span><span class="n">perturbate</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="c1"># returns pd.DataFrame({&quot;target&quot;: [1, 3, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
</code></pre></div></p>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">perturbate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Usage:</span>
<span class="sd">    ```python</span>
<span class="sd">    from cluster_experiments.perturbator import BetaRelativePositivePerturbator</span>
<span class="sd">    import pandas as pd</span>
<span class="sd">    df = pd.DataFrame({&quot;target&quot;: [1, 2, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">    perturbator = BetaRelativePositivePerturbator()</span>
<span class="sd">    # Increase target metric by 20%</span>
<span class="sd">    perturbator.perturbate(df, average_effect=0.2)</span>
<span class="sd">    # returns pd.DataFrame({&quot;target&quot;: [1, 3, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">average_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">check_beta_positive_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">)</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scale</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_treated</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">sampled_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample_beta_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_multiplicative_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">sampled_effect</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cluster_experiments.perturbator.BinaryPerturbator" class="doc doc-heading">
            <code>BinaryPerturbator</code>


<a href="#cluster_experiments.perturbator.BinaryPerturbator" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="cluster_experiments.perturbator.Perturbator" href="#cluster_experiments.perturbator.Perturbator">Perturbator</a></code></p>


        <p>BinaryPerturbator is a Perturbator that adds is used to deal with binary outcome variables.
It randomly selects some treated instances and flips their outcome from 0 to 1 or 1 to 0, depending on the effect being positive or negative</p>






              <details class="quote">
                <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BinaryPerturbator</span><span class="p">(</span><span class="n">Perturbator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    BinaryPerturbator is a Perturbator that adds is used to deal with binary outcome variables.</span>
<span class="sd">    It randomly selects some treated instances and flips their outcome from 0 to 1 or 1 to 0, depending on the effect being positive or negative</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_sample_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Like sample without replacement,</span>
<span class="sd">        but if you are to sample more than 100% of the data,</span>
<span class="sd">        it just returns the whole dataframe.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">df</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_data_checks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check that outcome is indeed binary, and average effect is in (-1, 1)&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">-</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">}:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Target column must be binary, found </span><span class="si">{</span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">average_effect</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">average_effect</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Average effect must be in (-1, 1), found </span><span class="si">{</span><span class="n">average_effect</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">perturbate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Usage:</span>

<span class="sd">        ```python</span>
<span class="sd">        from cluster_experiments.perturbator import BinaryPerturbator</span>
<span class="sd">        import pandas as pd</span>
<span class="sd">        df = pd.DataFrame({&quot;target&quot;: [1, 0, 1], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">        perturbator = BinaryPerturbator()</span>
<span class="sd">        perturbator.perturbate(df, average_effect=0.1)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">average_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_data_checks</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">)</span>

        <span class="n">from_target</span><span class="p">,</span> <span class="n">to_target</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">average_effect</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">from_target</span><span class="p">,</span> <span class="n">to_target</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>

        <span class="n">n_transformed</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">average_effect</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treated_query</span><span class="p">))))</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="c1"># Sample of negative cases in group B</span>
            <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="si">}</span><span class="s2"> == </span><span class="si">{</span><span class="n">from_target</span><span class="si">}</span><span class="s2"> &amp; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">treated_query</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sample_max</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_transformed</span><span class="p">)</span>
            <span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_target</span>
        <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.perturbator.BinaryPerturbator._data_checks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_data_checks</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">)</span></code>

<a href="#cluster_experiments.perturbator.BinaryPerturbator._data_checks" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Check that outcome is indeed binary, and average effect is in (-1, 1)</p>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_data_checks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check that outcome is indeed binary, and average effect is in (-1, 1)&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">-</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">}:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Target column must be binary, found </span><span class="si">{</span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">average_effect</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">average_effect</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Average effect must be in (-1, 1), found </span><span class="si">{</span><span class="n">average_effect</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.perturbator.BinaryPerturbator._sample_max" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_sample_max</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span></code>

<a href="#cluster_experiments.perturbator.BinaryPerturbator._sample_max" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Like sample without replacement,
but if you are to sample more than 100% of the data,
it just returns the whole dataframe.</p>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_sample_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Like sample without replacement,</span>
<span class="sd">    but if you are to sample more than 100% of the data,</span>
<span class="sd">    it just returns the whole dataframe.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">df</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.perturbator.BinaryPerturbator.perturbate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">perturbate</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#cluster_experiments.perturbator.BinaryPerturbator.perturbate" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Usage:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">cluster_experiments.perturbator</span><span class="w"> </span><span class="kn">import</span> <span class="n">BinaryPerturbator</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;treatment&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">]})</span>
<span class="n">perturbator</span> <span class="o">=</span> <span class="n">BinaryPerturbator</span><span class="p">()</span>
<span class="n">perturbator</span><span class="o">.</span><span class="n">perturbate</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">perturbate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Usage:</span>

<span class="sd">    ```python</span>
<span class="sd">    from cluster_experiments.perturbator import BinaryPerturbator</span>
<span class="sd">    import pandas as pd</span>
<span class="sd">    df = pd.DataFrame({&quot;target&quot;: [1, 0, 1], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">    perturbator = BinaryPerturbator()</span>
<span class="sd">    perturbator.perturbate(df, average_effect=0.1)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">average_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_data_checks</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">)</span>

    <span class="n">from_target</span><span class="p">,</span> <span class="n">to_target</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">average_effect</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">from_target</span><span class="p">,</span> <span class="n">to_target</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>

    <span class="n">n_transformed</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">average_effect</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treated_query</span><span class="p">))))</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
        <span class="c1"># Sample of negative cases in group B</span>
        <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="si">}</span><span class="s2"> == </span><span class="si">{</span><span class="n">from_target</span><span class="si">}</span><span class="s2"> &amp; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">treated_query</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sample_max</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_transformed</span><span class="p">)</span>
        <span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_target</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cluster_experiments.perturbator.ConstantPerturbator" class="doc doc-heading">
            <code>ConstantPerturbator</code>


<a href="#cluster_experiments.perturbator.ConstantPerturbator" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="cluster_experiments.perturbator.Perturbator" href="#cluster_experiments.perturbator.Perturbator">Perturbator</a></code></p>


        <p>ConstantPerturbator is a Perturbator that adds a constant effect to the target column of the treated instances.</p>






              <details class="quote">
                <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ConstantPerturbator</span><span class="p">(</span><span class="n">Perturbator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ConstantPerturbator is a Perturbator that adds a constant effect to the target column of the treated instances.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">perturbate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Usage:</span>

<span class="sd">        ```python</span>
<span class="sd">        from cluster_experiments.perturbator import ConstantPerturbator</span>
<span class="sd">        import pandas as pd</span>
<span class="sd">        df = pd.DataFrame({&quot;target&quot;: [1, 2, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">        perturbator = ConstantPerturbator()</span>
<span class="sd">        perturbator.perturbate(df, average_effect=1)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">average_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_additive_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_additive_effect</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">effect</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">treatment</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">]</span> <span class="o">+=</span> <span class="n">effect</span>
        <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.perturbator.ConstantPerturbator.perturbate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">perturbate</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#cluster_experiments.perturbator.ConstantPerturbator.perturbate" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Usage:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">cluster_experiments.perturbator</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConstantPerturbator</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;treatment&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">]})</span>
<span class="n">perturbator</span> <span class="o">=</span> <span class="n">ConstantPerturbator</span><span class="p">()</span>
<span class="n">perturbator</span><span class="o">.</span><span class="n">perturbate</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">perturbate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Usage:</span>

<span class="sd">    ```python</span>
<span class="sd">    from cluster_experiments.perturbator import ConstantPerturbator</span>
<span class="sd">    import pandas as pd</span>
<span class="sd">    df = pd.DataFrame({&quot;target&quot;: [1, 2, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">    perturbator = ConstantPerturbator()</span>
<span class="sd">    perturbator.perturbate(df, average_effect=1)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">average_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_additive_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cluster_experiments.perturbator.NormalPerturbator" class="doc doc-heading">
            <code>NormalPerturbator</code>


<a href="#cluster_experiments.perturbator.NormalPerturbator" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="cluster_experiments.perturbator.ConstantPerturbator" href="#cluster_experiments.perturbator.ConstantPerturbator">ConstantPerturbator</a></code></p>


        <p>The NormalPerturbator class implements a perturbator that adds a stochastic effect
to the target column of the treated instances. The stochastic effect is sampled from a
normal distribution with mean average_effect and variance scale. If scale is not
provided, the variance is abs(average_effect). If scale is provided, a
value not much bigger than the average_effect is suggested.</p>
<div class="highlight"><pre><span></span><code>target -&gt; target + effect, where effect ~ Normal(average_effect, scale)
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>average_effect</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the average effect of the treatment. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the target_col to use as the outcome. Defaults to "target".</p>
              </div>
            </td>
            <td>
                  <code>&#39;target&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>treatment_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the name of the column that contains the treatment. Defaults to "treatment".</p>
              </div>
            </td>
            <td>
                  <code>&#39;treatment&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>treatment</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the treatment to use as the treated group. Defaults to "B".</p>
              </div>
            </td>
            <td>
                  <code>&#39;B&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scale</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the scale of the effect distribution. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">NormalPerturbator</span><span class="p">(</span><span class="n">ConstantPerturbator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The NormalPerturbator class implements a perturbator that adds a stochastic effect</span>
<span class="sd">    to the target column of the treated instances. The stochastic effect is sampled from a</span>
<span class="sd">    normal distribution with mean average_effect and variance scale. If scale is not</span>
<span class="sd">    provided, the variance is abs(average_effect). If scale is provided, a</span>
<span class="sd">    value not much bigger than the average_effect is suggested.</span>

<span class="sd">    ```</span>
<span class="sd">    target -&gt; target + effect, where effect ~ Normal(average_effect, scale)</span>
<span class="sd">    ```</span>

<span class="sd">    Arguments:</span>
<span class="sd">        average_effect (Optional[float], optional): the average effect of the treatment. Defaults to None.</span>
<span class="sd">        target_col (str, optional): name of the target_col to use as the outcome. Defaults to &quot;target&quot;.</span>
<span class="sd">        treatment_col (str, optional): the name of the column that contains the treatment. Defaults to &quot;treatment&quot;.</span>
<span class="sd">        treatment (str, optional): name of the treatment to use as the treated group. Defaults to &quot;B&quot;.</span>
<span class="sd">        scale (Optional[float], optional): the scale of the effect distribution. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;target&quot;</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;treatment&quot;</span><span class="p">,</span>
        <span class="n">treatment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span>
        <span class="n">scale</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">treatment_col</span><span class="p">,</span> <span class="n">treatment</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span> <span class="o">=</span> <span class="n">scale</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">perturbate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perturbate with a normal effect with mean average_effect and</span>
<span class="sd">        std abs(average_effect).</span>

<span class="sd">        Arguments:</span>
<span class="sd">            df (pd.DataFrame): the dataframe to perturbate.</span>
<span class="sd">            average_effect (Optional[float], optional): the average effect. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: the perturbated dataframe.</span>

<span class="sd">        Usage:</span>

<span class="sd">        ```python</span>
<span class="sd">        from cluster_experiments.perturbator import NormalPerturbator</span>
<span class="sd">        import pandas as pd</span>
<span class="sd">        df = pd.DataFrame({&quot;target&quot;: [1, 2, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">        perturbator = NormalPerturbator()</span>
<span class="sd">        perturbator.perturbate(df, average_effect=1)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">average_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scale</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_treated</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">sampled_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample_normal_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_additive_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">sampled_effect</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the scale of the normal distribution. If scale is not provided, the</span>
<span class="sd">        variance is abs(average_effect). Raises a ValueError if scale is not positive.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;scale must be positive, got </span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scale</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_number_of_treated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the number of treated instances in the dataframe&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">treatment</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_sample_normal_effect</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a Perturbator object from a PowerConfig object&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">average_effect</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">average_effect</span><span class="p">,</span>
            <span class="n">target_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">target_col</span><span class="p">,</span>
            <span class="n">treatment_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">,</span>
            <span class="n">treatment</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment</span><span class="p">,</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.perturbator.NormalPerturbator.from_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#cluster_experiments.perturbator.NormalPerturbator.from_config" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Creates a Perturbator object from a PowerConfig object</p>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a Perturbator object from a PowerConfig object&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">average_effect</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">average_effect</span><span class="p">,</span>
        <span class="n">target_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">target_col</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">,</span>
        <span class="n">treatment</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment</span><span class="p">,</span>
        <span class="n">scale</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.perturbator.NormalPerturbator.get_number_of_treated" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_number_of_treated</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></code>

<a href="#cluster_experiments.perturbator.NormalPerturbator.get_number_of_treated" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get the number of treated instances in the dataframe</p>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_number_of_treated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the number of treated instances in the dataframe&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">treatment</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.perturbator.NormalPerturbator.get_scale" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_scale</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span></code>

<a href="#cluster_experiments.perturbator.NormalPerturbator.get_scale" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get the scale of the normal distribution. If scale is not provided, the
variance is abs(average_effect). Raises a ValueError if scale is not positive.</p>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the scale of the normal distribution. If scale is not provided, the</span>
<span class="sd">    variance is abs(average_effect). Raises a ValueError if scale is not positive.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span>
    <span class="k">if</span> <span class="n">scale</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;scale must be positive, got </span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">scale</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.perturbator.NormalPerturbator.perturbate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">perturbate</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#cluster_experiments.perturbator.NormalPerturbator.perturbate" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Perturbate with a normal effect with mean average_effect and
std abs(average_effect).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the dataframe to perturbate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>average_effect</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the average effect. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: the perturbated dataframe.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Usage:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">cluster_experiments.perturbator</span><span class="w"> </span><span class="kn">import</span> <span class="n">NormalPerturbator</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;treatment&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">]})</span>
<span class="n">perturbator</span> <span class="o">=</span> <span class="n">NormalPerturbator</span><span class="p">()</span>
<span class="n">perturbator</span><span class="o">.</span><span class="n">perturbate</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">perturbate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perturbate with a normal effect with mean average_effect and</span>
<span class="sd">    std abs(average_effect).</span>

<span class="sd">    Arguments:</span>
<span class="sd">        df (pd.DataFrame): the dataframe to perturbate.</span>
<span class="sd">        average_effect (Optional[float], optional): the average effect. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: the perturbated dataframe.</span>

<span class="sd">    Usage:</span>

<span class="sd">    ```python</span>
<span class="sd">    from cluster_experiments.perturbator import NormalPerturbator</span>
<span class="sd">    import pandas as pd</span>
<span class="sd">    df = pd.DataFrame({&quot;target&quot;: [1, 2, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">    perturbator = NormalPerturbator()</span>
<span class="sd">    perturbator.perturbate(df, average_effect=1)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">average_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scale</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_treated</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">sampled_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample_normal_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_additive_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">sampled_effect</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cluster_experiments.perturbator.Perturbator" class="doc doc-heading">
            <code>Perturbator</code>


<a href="#cluster_experiments.perturbator.Perturbator" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>Abstract perturbator. Perturbators are used to simulate a fictitious effect when running a power analysis.</p>
<p>The idea is that, when running a power analysis, we split our instances according to a RandomSplitter, and the
instances that got the treatment, are perturbated with a fictional effect via the Perturbator.</p>
<p>In order to create your own perturbator, you should create a derived class that implements the perturbate method.
The perturbate method should add the average effect in the desired way and return the dataframe with the extra average effect,
without affecting the initial dataframe. Keep in mind to use <code>df = df.copy()</code> in the first line of the perturbate method.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>average_effect</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The average effect of the treatment</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the target_col to use as the outcome</p>
              </div>
            </td>
            <td>
                  <code>&#39;target&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>treatment_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the column that contains the treatment</p>
              </div>
            </td>
            <td>
                  <code>&#39;treatment&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>treatment</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the treatment to use as the treated group</p>
              </div>
            </td>
            <td>
                  <code>&#39;B&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Perturbator</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract perturbator. Perturbators are used to simulate a fictitious effect when running a power analysis.</span>

<span class="sd">    The idea is that, when running a power analysis, we split our instances according to a RandomSplitter, and the</span>
<span class="sd">    instances that got the treatment, are perturbated with a fictional effect via the Perturbator.</span>

<span class="sd">    In order to create your own perturbator, you should create a derived class that implements the perturbate method.</span>
<span class="sd">    The perturbate method should add the average effect in the desired way and return the dataframe with the extra average effect,</span>
<span class="sd">    without affecting the initial dataframe. Keep in mind to use `df = df.copy()` in the first line of the perturbate method.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        average_effect: The average effect of the treatment</span>
<span class="sd">        target_col: name of the target_col to use as the outcome</span>
<span class="sd">        treatment_col: The name of the column that contains the treatment</span>
<span class="sd">        treatment: name of the treatment to use as the treated group</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;target&quot;</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;treatment&quot;</span><span class="p">,</span>
        <span class="n">treatment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">average_effect</span> <span class="o">=</span> <span class="n">average_effect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span> <span class="o">=</span> <span class="n">target_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span> <span class="o">=</span> <span class="n">treatment_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treatment</span> <span class="o">=</span> <span class="n">treatment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treated_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span><span class="si">}</span><span class="s2"> == &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">treatment</span><span class="si">}</span><span class="s2">&#39;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_average_effect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">average_effect</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">average_effect</span> <span class="k">if</span> <span class="n">average_effect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">average_effect</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">average_effect</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;average_effect must be provided, either in the constructor or in the method call&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">average_effect</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">perturbate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method to perturbate a dataframe&quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a Perturbator object from a PowerConfig object&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">average_effect</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">average_effect</span><span class="p">,</span>
            <span class="n">target_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">target_col</span><span class="p">,</span>
            <span class="n">treatment_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">,</span>
            <span class="n">treatment</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.perturbator.Perturbator.from_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#cluster_experiments.perturbator.Perturbator.from_config" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Creates a Perturbator object from a PowerConfig object</p>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a Perturbator object from a PowerConfig object&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">average_effect</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">average_effect</span><span class="p">,</span>
        <span class="n">target_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">target_col</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">,</span>
        <span class="n">treatment</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.perturbator.Perturbator.perturbate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">perturbate</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#cluster_experiments.perturbator.Perturbator.perturbate" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Method to perturbate a dataframe</p>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">perturbate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method to perturbate a dataframe&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cluster_experiments.perturbator.RelativeMixedPerturbator" class="doc doc-heading">
            <code>RelativeMixedPerturbator</code>


<a href="#cluster_experiments.perturbator.RelativeMixedPerturbator" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="cluster_experiments.perturbator.Perturbator" href="#cluster_experiments.perturbator.Perturbator">Perturbator</a></code></p>


        <p>RelativeMixedPerturbator is a Perturbator that applies a multiplicative effect to the target column
of treated instances, modifying their values by a relative factor depending on whether they are positive
or negative.</p>






              <details class="quote">
                <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RelativeMixedPerturbator</span><span class="p">(</span><span class="n">Perturbator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    RelativeMixedPerturbator is a Perturbator that applies a multiplicative effect to the target column</span>
<span class="sd">    of treated instances, modifying their values by a relative factor depending on whether they are positive</span>
<span class="sd">    or negative.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">perturbate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply the multiplicative effect to the target column of the treated instances. The effect is calculated</span>
<span class="sd">        as a factor of (1 + effect) for non-negative values, and (1 - effect) for negative values.</span>

<span class="sd">        Usage:</span>

<span class="sd">        ```python</span>
<span class="sd">        from cluster_experiments.perturbator import RelativeMixedPerturbator</span>
<span class="sd">        import pandas as pd</span>
<span class="sd">        df = pd.DataFrame({&quot;target&quot;: [1, -2, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">        perturbator = RelativeMixedPerturbator()</span>
<span class="sd">        perturbator.perturbate(df, average_effect=0.1)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">average_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_multiplicative_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_multiplicative_effect</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">effect</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply the relative multiplicative effect to the target column, adjusting values based on whether</span>
<span class="sd">        they are positive or negative.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">treatment</span>
        <span class="n">original_values</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">]</span>

        <span class="c1"># Calculate new values: apply (1 + effect) for non-negative, (1 - effect) for negative values</span>
        <span class="n">new_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="n">original_values</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">original_values</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">effect</span><span class="p">),</span>
            <span class="n">original_values</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">effect</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># The round is required to avoid float imprecision</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">new_values</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.perturbator.RelativeMixedPerturbator.apply_multiplicative_effect" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_multiplicative_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">effect</span><span class="p">)</span></code>

<a href="#cluster_experiments.perturbator.RelativeMixedPerturbator.apply_multiplicative_effect" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Apply the relative multiplicative effect to the target column, adjusting values based on whether
they are positive or negative.</p>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">apply_multiplicative_effect</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">effect</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply the relative multiplicative effect to the target column, adjusting values based on whether</span>
<span class="sd">    they are positive or negative.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">treatment</span>
    <span class="n">original_values</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">]</span>

    <span class="c1"># Calculate new values: apply (1 + effect) for non-negative, (1 - effect) for negative values</span>
    <span class="n">new_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="n">original_values</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">original_values</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">effect</span><span class="p">),</span>
        <span class="n">original_values</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">effect</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># The round is required to avoid float imprecision</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">new_values</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.perturbator.RelativeMixedPerturbator.perturbate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">perturbate</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#cluster_experiments.perturbator.RelativeMixedPerturbator.perturbate" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Apply the multiplicative effect to the target column of the treated instances. The effect is calculated
as a factor of (1 + effect) for non-negative values, and (1 - effect) for negative values.</p>
<p>Usage:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">cluster_experiments.perturbator</span><span class="w"> </span><span class="kn">import</span> <span class="n">RelativeMixedPerturbator</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;treatment&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">]})</span>
<span class="n">perturbator</span> <span class="o">=</span> <span class="n">RelativeMixedPerturbator</span><span class="p">()</span>
<span class="n">perturbator</span><span class="o">.</span><span class="n">perturbate</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">perturbate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply the multiplicative effect to the target column of the treated instances. The effect is calculated</span>
<span class="sd">    as a factor of (1 + effect) for non-negative values, and (1 - effect) for negative values.</span>

<span class="sd">    Usage:</span>

<span class="sd">    ```python</span>
<span class="sd">    from cluster_experiments.perturbator import RelativeMixedPerturbator</span>
<span class="sd">    import pandas as pd</span>
<span class="sd">    df = pd.DataFrame({&quot;target&quot;: [1, -2, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">    perturbator = RelativeMixedPerturbator()</span>
<span class="sd">    perturbator.perturbate(df, average_effect=0.1)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">average_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_multiplicative_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cluster_experiments.perturbator.RelativePositivePerturbator" class="doc doc-heading">
            <code>RelativePositivePerturbator</code>


<a href="#cluster_experiments.perturbator.RelativePositivePerturbator" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="cluster_experiments.perturbator.Perturbator" href="#cluster_experiments.perturbator.Perturbator">Perturbator</a></code></p>


        <p>A Perturbator for continuous, positively-defined targets
applies a simulated effect multiplicatively for the treated samples, ie.
proportional to the target value for each sample. The number of samples with 0
as target remains unchanged.</p>
<div class="highlight"><pre><span></span><code>target -&gt; target * (1 + average_effect), where -1 &lt; average_effect &lt; inf
                                           and target &gt; 0 for all samples
</code></pre></div>






              <details class="quote">
                <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RelativePositivePerturbator</span><span class="p">(</span><span class="n">Perturbator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Perturbator for continuous, positively-defined targets</span>
<span class="sd">    applies a simulated effect multiplicatively for the treated samples, ie.</span>
<span class="sd">    proportional to the target value for each sample. The number of samples with 0</span>
<span class="sd">    as target remains unchanged.</span>

<span class="sd">    ```</span>
<span class="sd">    target -&gt; target * (1 + average_effect), where -1 &lt; average_effect &lt; inf</span>
<span class="sd">                                               and target &gt; 0 for all samples</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">perturbate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Usage:</span>
<span class="sd">        ```python</span>
<span class="sd">        from cluster_experiments.perturbator import RelativePositivePerturbator</span>
<span class="sd">        import pandas as pd</span>
<span class="sd">        df = pd.DataFrame({&quot;target&quot;: [1, 2, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">        perturbator = RelativePositivePerturbator()</span>
<span class="sd">        # Increase target metric by 50%</span>
<span class="sd">        perturbator.perturbate(df, average_effect=0.5)</span>
<span class="sd">        # returns pd.DataFrame({&quot;target&quot;: [1, 3, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">average_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_relative_positive_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_multiplicative_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_relative_positive_effect</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_average_effect_greater_than</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">x</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_target_is_not_negative</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_target_is_not_constant_zero</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_target_is_not_constant_zero</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NoReturn</span><span class="p">]:</span>
        <span class="n">treatment_zeros</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">treatment</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="k">if</span> <span class="mf">1.0</span> <span class="o">==</span> <span class="n">treatment_zeros</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;All treatment samples have </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="si">}</span><span class="s2"> = 0, relative effect &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">average_effect</span><span class="si">}</span><span class="s2"> will have no effect&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_target_is_not_negative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NoReturn</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;All </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="si">}</span><span class="s2"> values need to be positive or 0, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;got </span><span class="si">{</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_average_effect_greater_than</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NoReturn</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">average_effect</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Simulated effect needs to be greater than </span><span class="si">{</span><span class="n">x</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">%, got &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">average_effect</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_multiplicative_effect</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">effect</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">treatment</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">effect</span>
        <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.perturbator.RelativePositivePerturbator.perturbate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">perturbate</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#cluster_experiments.perturbator.RelativePositivePerturbator.perturbate" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Usage:
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">cluster_experiments.perturbator</span><span class="w"> </span><span class="kn">import</span> <span class="n">RelativePositivePerturbator</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;treatment&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">]})</span>
<span class="n">perturbator</span> <span class="o">=</span> <span class="n">RelativePositivePerturbator</span><span class="p">()</span>
<span class="c1"># Increase target metric by 50%</span>
<span class="n">perturbator</span><span class="o">.</span><span class="n">perturbate</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="c1"># returns pd.DataFrame({&quot;target&quot;: [1, 3, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
</code></pre></div></p>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">perturbate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Usage:</span>
<span class="sd">    ```python</span>
<span class="sd">    from cluster_experiments.perturbator import RelativePositivePerturbator</span>
<span class="sd">    import pandas as pd</span>
<span class="sd">    df = pd.DataFrame({&quot;target&quot;: [1, 2, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">    perturbator = RelativePositivePerturbator()</span>
<span class="sd">    # Increase target metric by 50%</span>
<span class="sd">    perturbator.perturbate(df, average_effect=0.5)</span>
<span class="sd">    # returns pd.DataFrame({&quot;target&quot;: [1, 3, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">average_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">check_relative_positive_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_multiplicative_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cluster_experiments.perturbator.SegmentedBetaRelativePerturbator" class="doc doc-heading">
            <code>SegmentedBetaRelativePerturbator</code>


<a href="#cluster_experiments.perturbator.SegmentedBetaRelativePerturbator" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="cluster_experiments.perturbator.BetaRelativePositivePerturbator" href="#cluster_experiments.perturbator.BetaRelativePositivePerturbator">BetaRelativePositivePerturbator</a></code></p>


        <p>A stochastic Perturbator for continuous targets that applies a sampled
effect from the Beta distribution. It applies the effect multiplicatively
and based on given segments.
For each segment, the average segment effect is sampled from a beta
distribution with support in (0, 1). Within each segment, the individual
effects are sampled from a beta distribution with mean equal to the segment
average effect and support in (range_min, range_max).</p>
<p>The number of samples with 0 as target remains unchanged.</p>
<p>For additional details and recommendations on the parameters, see the
documentation for the <code>BetaRelativePerturbator</code> class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>average_effect</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the average effect of the treatment. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the target_col to use as the outcome. Defaults to "target".</p>
              </div>
            </td>
            <td>
                  <code>&#39;target&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>treatment_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the name of the column that contains the treatment. Defaults to "treatment".</p>
              </div>
            </td>
            <td>
                  <code>&#39;treatment&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>treatment</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the treatment to use as the treated group. Defaults to "B".</p>
              </div>
            </td>
            <td>
                  <code>&#39;B&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scale</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the scale of the effect distribution. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>range_min</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the minimum value of the target range, must be &gt;-1.
Defaults to -0.8, which allows for up to 5x decreases of the target.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>range_max</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the maximum value of the target range.
Defaults to 4, which allows for up to 5x increases of the target.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>segment_cols</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the columns to use for segmenting. Defaults to None.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SegmentedBetaRelativePerturbator</span><span class="p">(</span><span class="n">BetaRelativePositivePerturbator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A stochastic Perturbator for continuous targets that applies a sampled</span>
<span class="sd">    effect from the Beta distribution. It applies the effect multiplicatively</span>
<span class="sd">    and based on given segments.</span>
<span class="sd">    For each segment, the average segment effect is sampled from a beta</span>
<span class="sd">    distribution with support in (0, 1). Within each segment, the individual</span>
<span class="sd">    effects are sampled from a beta distribution with mean equal to the segment</span>
<span class="sd">    average effect and support in (range_min, range_max).</span>

<span class="sd">    The number of samples with 0 as target remains unchanged.</span>

<span class="sd">    For additional details and recommendations on the parameters, see the</span>
<span class="sd">    documentation for the `BetaRelativePerturbator` class.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        average_effect (Optional[float], optional): the average effect of the treatment. Defaults to None.</span>
<span class="sd">        target_col (str, optional): name of the target_col to use as the outcome. Defaults to &quot;target&quot;.</span>
<span class="sd">        treatment_col (str, optional): the name of the column that contains the treatment. Defaults to &quot;treatment&quot;.</span>
<span class="sd">        treatment (str, optional): name of the treatment to use as the treated group. Defaults to &quot;B&quot;.</span>
<span class="sd">        scale (Optional[float], optional): the scale of the effect distribution. Defaults to None.</span>
<span class="sd">        range_min (float, optional): the minimum value of the target range, must be &gt;-1.</span>
<span class="sd">            Defaults to -0.8, which allows for up to 5x decreases of the target.</span>
<span class="sd">        range_max (float, optional): the maximum value of the target range.</span>
<span class="sd">            Defaults to 4, which allows for up to 5x increases of the target.</span>
<span class="sd">        segment_cols (Optional[List[str]], optional): the columns to use for segmenting. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">segment_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;target&quot;</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;treatment&quot;</span><span class="p">,</span>
        <span class="n">treatment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span>
        <span class="n">scale</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">range_min</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">range_max</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">treatment_col</span><span class="p">,</span> <span class="n">treatment</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_range_min</span> <span class="o">=</span> <span class="n">range_min</span> <span class="ow">or</span> <span class="o">-</span><span class="mf">0.8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_range_max</span> <span class="o">=</span> <span class="n">range_max</span> <span class="ow">or</span> <span class="mi">4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_segment_cols</span> <span class="o">=</span> <span class="n">segment_cols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">segment_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_segment_col_name</span><span class="p">(</span><span class="n">segment_cols</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_segment_col_name</span><span class="p">(</span><span class="n">segment_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">segment_cols</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;segment_cols must be of type List[str], got type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">segment_cols</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;_cluster_&quot;</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">segment_cols</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_set_segment_col_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Cannot use </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_col</span><span class="si">=}</span><span class="s2"> as perturbator clustering &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;column, as it already exists in the input dataframe!&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
            <span class="o">**</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_col</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_segment_cols</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)}</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_cluster_perturbator_fixed_params</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">average_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_average_effect_greater_than</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_average_effect_less_than</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scale</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;average_effect&quot;</span><span class="p">:</span> <span class="n">average_effect</span><span class="p">,</span>
            <span class="s2">&quot;scale&quot;</span><span class="p">:</span> <span class="n">scale</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_cluster_perturbator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Perturbator</span><span class="p">:</span>
        <span class="n">sampled_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample_beta_effect</span><span class="p">(</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;average_effect&quot;</span><span class="p">],</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;scale&quot;</span><span class="p">],</span> <span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">cluster_perturbator</span> <span class="o">=</span> <span class="n">BetaRelativePerturbator</span><span class="p">(</span>
            <span class="n">average_effect</span><span class="o">=</span><span class="n">sampled_effect</span><span class="p">,</span>
            <span class="n">target_col</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">,</span>
            <span class="n">treatment_col</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">,</span>
            <span class="n">treatment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">treatment</span><span class="p">,</span>
            <span class="n">range_min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_range_min</span><span class="p">,</span>
            <span class="n">range_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_range_max</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">cluster_perturbator</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">perturbate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_segment_col_values</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="n">cluster_perturbator_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cluster_perturbator_fixed_params</span><span class="p">(</span>
            <span class="n">average_effect</span>
        <span class="p">)</span>
        <span class="n">df_perturbed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_cluster_perturbator</span><span class="p">(</span><span class="o">**</span><span class="n">cluster_perturbator_params</span><span class="p">)</span><span class="o">.</span><span class="n">perturbate</span><span class="p">(</span>
                    <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_col</span><span class="p">]</span> <span class="o">==</span> <span class="n">cluster</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">df_perturbed</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_col</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a Perturbator object from a PowerConfig object&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">average_effect</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">average_effect</span><span class="p">,</span>
            <span class="n">target_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">target_col</span><span class="p">,</span>
            <span class="n">treatment_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">,</span>
            <span class="n">treatment</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment</span><span class="p">,</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span>
            <span class="n">range_min</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">range_min</span><span class="p">,</span>
            <span class="n">range_max</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">range_max</span><span class="p">,</span>
            <span class="n">segment_cols</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">segment_cols</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.perturbator.SegmentedBetaRelativePerturbator.from_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#cluster_experiments.perturbator.SegmentedBetaRelativePerturbator.from_config" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Creates a Perturbator object from a PowerConfig object</p>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a Perturbator object from a PowerConfig object&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">average_effect</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">average_effect</span><span class="p">,</span>
        <span class="n">target_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">target_col</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">,</span>
        <span class="n">treatment</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment</span><span class="p">,</span>
        <span class="n">scale</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span>
        <span class="n">range_min</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">range_min</span><span class="p">,</span>
        <span class="n">range_max</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">range_max</span><span class="p">,</span>
        <span class="n">segment_cols</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">segment_cols</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cluster_experiments.perturbator.UniformPerturbator" class="doc doc-heading">
            <code>UniformPerturbator</code>


<a href="#cluster_experiments.perturbator.UniformPerturbator" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="cluster_experiments.perturbator.Perturbator" href="#cluster_experiments.perturbator.Perturbator">Perturbator</a></code></p>


        <p>UniformPerturbator is a Perturbator that adds a constant effect to the target column of the treated instances.</p>






              <details class="quote">
                <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">UniformPerturbator</span><span class="p">(</span><span class="n">Perturbator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    UniformPerturbator is a Perturbator that adds a constant effect to the target column of the treated instances.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;target&quot;</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;treatment&quot;</span><span class="p">,</span>
        <span class="n">treatment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">average_effect</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">treatment_col</span><span class="p">,</span> <span class="n">treatment</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;UniformPerturbator is deprecated and will be removed in future versions. &quot;</span>
            <span class="s2">&quot;Use ConstantPerturbator instead.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">perturbate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Usage:</span>

<span class="sd">        ```python</span>
<span class="sd">        from cluster_experiments.perturbator import UniformPerturbator</span>
<span class="sd">        import pandas as pd</span>
<span class="sd">        df = pd.DataFrame({&quot;target&quot;: [1, 2, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">        perturbator = UniformPerturbator()</span>
<span class="sd">        perturbator.perturbate(df, average_effect=1)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">average_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_additive_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_additive_effect</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">effect</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">treatment</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_col</span><span class="p">]</span> <span class="o">+=</span> <span class="n">effect</span>
        <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.perturbator.UniformPerturbator.perturbate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">perturbate</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#cluster_experiments.perturbator.UniformPerturbator.perturbate" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Usage:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">cluster_experiments.perturbator</span><span class="w"> </span><span class="kn">import</span> <span class="n">UniformPerturbator</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;treatment&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">]})</span>
<span class="n">perturbator</span> <span class="o">=</span> <span class="n">UniformPerturbator</span><span class="p">()</span>
<span class="n">perturbator</span><span class="o">.</span><span class="n">perturbate</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/perturbator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">perturbate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Usage:</span>

<span class="sd">    ```python</span>
<span class="sd">    from cluster_experiments.perturbator import UniformPerturbator</span>
<span class="sd">    import pandas as pd</span>
<span class="sd">    df = pd.DataFrame({&quot;target&quot;: [1, 2, 3], &quot;treatment&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;A&quot;]})</span>
<span class="sd">    perturbator = UniformPerturbator()</span>
<span class="sd">    perturbator.perturbate(df, average_effect=1)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">average_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_average_effect</span><span class="p">(</span><span class="n">average_effect</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_additive_effect</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">average_effect</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022 Maintained by David Masip.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/david26694/cluster-experiments" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.tabs", "content.code.annotate", "content.code.copy", "navigation.instant", "navigation.tracking", "navigation.top"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
    
  </body>
</html>