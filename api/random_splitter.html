
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Functions to design and run clustered experiments">
      
      
        <meta name="author" content="David Masip">
      
      
        <link rel="canonical" href="https://david26694.github.io/cluster-experiments/api/random_splitter.html">
      
      
        <link rel="prev" href="power_config.html">
      
      
        <link rel="next" href="cupac_model.html">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.5">
    
    
      
        <title>Splitters - Cluster Experiments Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,300i,400,400i,700,700i%7CUbuntu+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Ubuntu";--md-code-font:"Ubuntu Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../stylesheets/overrides.css">
    
      <link rel="stylesheet" href="../stylesheets/style.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#from-cluster_experimentsrandom_splitter-import" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="Cluster Experiments Docs" class="md-header__button md-logo" aria-label="Cluster Experiments Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cluster Experiments Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Splitters
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/david26694/cluster-experiments" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Cluster Experiments Docs" class="md-nav__button md-logo" aria-label="Cluster Experiments Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Cluster Experiments Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/david26694/cluster-experiments" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Quickstart
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../normal_power_lines.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Power Analysis Guide
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Basic Usage
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Basic Usage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/simple_ab_test.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Simple A/B Test Example
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../experiment_analysis.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Experiment Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../aa_test.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AA Test (Clustered)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../relative.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Relative Lift Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    End-to-End Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            End-to-End Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../e2e_mde.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    End-to-end: Power Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../e2e_mde_switchback.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    End-to-end: Switchback Design
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../e2e_mde_delta.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    End-to-end: Delta Method
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Analysis Methods
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Analysis Methods
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../analysis_with_different_hypotheses.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Power comparison under different hypotheses
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../paired_ttest.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Paired T-Test
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../delta_method.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Delta Method Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Variance Reduction
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Variance Reduction
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cupac_example.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CUPAC Example
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Cluster Experiments
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            Cluster Experiments
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/cluster_randomization.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cluster Randomization Example
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Switchback Experiments
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            Switchback Experiments
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../switchback.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Stratified Switchback
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plot_calendars.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Calendar Visualization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plot_calendars_hours.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4-Hour Switches
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../washover_example.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Washover Example
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" >
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Power Analysis
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            Power Analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../normal_power.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Normal Power Comparison
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../normal_power_lines.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Power Analysis Guide
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8" >
        
          
          <label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Advanced Topics
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            Advanced Topics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multivariate.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multiple Treatments
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../synthetic_control.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Synthetic Control
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../create_custom_classes.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom Classes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Experiment Analysis
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Experiment Analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="analysis_plan.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Analysis Plan
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="analysis_results.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Analysis Results
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="experiment_analysis.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Experiment Analysis Methods
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="hypothesis_test.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hypothesis Test
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Metrics & Variants
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Metrics & Variants
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="metric.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Metric
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="variant.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Variant
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="dimension.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dimension
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Power Analysis
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Power Analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="power_analysis.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Power Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="power_config.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Power Config
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Randomization
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Randomization
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Splitters
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="random_splitter.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Splitters
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter" class="md-nav__link">
    <span class="md-ellipsis">
      random_splitter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.BalancedClusteredSplitter" class="md-nav__link">
    <span class="md-ellipsis">
      BalancedClusteredSplitter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BalancedClusteredSplitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.BalancedClusteredSplitter.sample_treatment" class="md-nav__link">
    <span class="md-ellipsis">
      sample_treatment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.BalancedSwitchbackSplitter" class="md-nav__link">
    <span class="md-ellipsis">
      BalancedSwitchbackSplitter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.ClusteredSplitter" class="md-nav__link">
    <span class="md-ellipsis">
      ClusteredSplitter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ClusteredSplitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.ClusteredSplitter.assign_treatment_df" class="md-nav__link">
    <span class="md-ellipsis">
      assign_treatment_df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.ClusteredSplitter.sample_treatment" class="md-nav__link">
    <span class="md-ellipsis">
      sample_treatment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.FixedSizeClusteredSplitter" class="md-nav__link">
    <span class="md-ellipsis">
      FixedSizeClusteredSplitter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FixedSizeClusteredSplitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.FixedSizeClusteredSplitter.sample_treatment" class="md-nav__link">
    <span class="md-ellipsis">
      sample_treatment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.NonClusteredSplitter" class="md-nav__link">
    <span class="md-ellipsis">
      NonClusteredSplitter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NonClusteredSplitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.NonClusteredSplitter.assign_treatment_df" class="md-nav__link">
    <span class="md-ellipsis">
      assign_treatment_df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.NonClusteredSplitter.from_config" class="md-nav__link">
    <span class="md-ellipsis">
      from_config
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.RandomSplitter" class="md-nav__link">
    <span class="md-ellipsis">
      RandomSplitter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RandomSplitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.RandomSplitter.assign_treatment_df" class="md-nav__link">
    <span class="md-ellipsis">
      assign_treatment_df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.RandomSplitter.from_config" class="md-nav__link">
    <span class="md-ellipsis">
      from_config
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.RepeatedSampler" class="md-nav__link">
    <span class="md-ellipsis">
      RepeatedSampler
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RepeatedSampler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.RepeatedSampler.from_config" class="md-nav__link">
    <span class="md-ellipsis">
      from_config
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.StratifiedClusteredSplitter" class="md-nav__link">
    <span class="md-ellipsis">
      StratifiedClusteredSplitter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="StratifiedClusteredSplitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.StratifiedClusteredSplitter.from_config" class="md-nav__link">
    <span class="md-ellipsis">
      from_config
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.StratifiedSwitchbackSplitter" class="md-nav__link">
    <span class="md-ellipsis">
      StratifiedSwitchbackSplitter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="StratifiedSwitchbackSplitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.StratifiedSwitchbackSplitter.from_config" class="md-nav__link">
    <span class="md-ellipsis">
      from_config
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.SwitchbackSplitter" class="md-nav__link">
    <span class="md-ellipsis">
      SwitchbackSplitter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SwitchbackSplitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.SwitchbackSplitter._check_clusters" class="md-nav__link">
    <span class="md-ellipsis">
      _check_clusters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.SwitchbackSplitter.assign_treatment_df" class="md-nav__link">
    <span class="md-ellipsis">
      assign_treatment_df
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Variance Reduction
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            Variance Reduction
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="cupac_model.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CUPAC Model
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6" >
        
          
          <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Switchback
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            Switchback
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="washover.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Washover
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="perturbator.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Perturbators
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../CONTRIBUTING.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../license.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    License
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter" class="md-nav__link">
    <span class="md-ellipsis">
      random_splitter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.BalancedClusteredSplitter" class="md-nav__link">
    <span class="md-ellipsis">
      BalancedClusteredSplitter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BalancedClusteredSplitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.BalancedClusteredSplitter.sample_treatment" class="md-nav__link">
    <span class="md-ellipsis">
      sample_treatment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.BalancedSwitchbackSplitter" class="md-nav__link">
    <span class="md-ellipsis">
      BalancedSwitchbackSplitter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.ClusteredSplitter" class="md-nav__link">
    <span class="md-ellipsis">
      ClusteredSplitter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ClusteredSplitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.ClusteredSplitter.assign_treatment_df" class="md-nav__link">
    <span class="md-ellipsis">
      assign_treatment_df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.ClusteredSplitter.sample_treatment" class="md-nav__link">
    <span class="md-ellipsis">
      sample_treatment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.FixedSizeClusteredSplitter" class="md-nav__link">
    <span class="md-ellipsis">
      FixedSizeClusteredSplitter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FixedSizeClusteredSplitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.FixedSizeClusteredSplitter.sample_treatment" class="md-nav__link">
    <span class="md-ellipsis">
      sample_treatment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.NonClusteredSplitter" class="md-nav__link">
    <span class="md-ellipsis">
      NonClusteredSplitter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NonClusteredSplitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.NonClusteredSplitter.assign_treatment_df" class="md-nav__link">
    <span class="md-ellipsis">
      assign_treatment_df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.NonClusteredSplitter.from_config" class="md-nav__link">
    <span class="md-ellipsis">
      from_config
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.RandomSplitter" class="md-nav__link">
    <span class="md-ellipsis">
      RandomSplitter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RandomSplitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.RandomSplitter.assign_treatment_df" class="md-nav__link">
    <span class="md-ellipsis">
      assign_treatment_df
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.RandomSplitter.from_config" class="md-nav__link">
    <span class="md-ellipsis">
      from_config
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.RepeatedSampler" class="md-nav__link">
    <span class="md-ellipsis">
      RepeatedSampler
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RepeatedSampler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.RepeatedSampler.from_config" class="md-nav__link">
    <span class="md-ellipsis">
      from_config
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.StratifiedClusteredSplitter" class="md-nav__link">
    <span class="md-ellipsis">
      StratifiedClusteredSplitter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="StratifiedClusteredSplitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.StratifiedClusteredSplitter.from_config" class="md-nav__link">
    <span class="md-ellipsis">
      from_config
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.StratifiedSwitchbackSplitter" class="md-nav__link">
    <span class="md-ellipsis">
      StratifiedSwitchbackSplitter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="StratifiedSwitchbackSplitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.StratifiedSwitchbackSplitter.from_config" class="md-nav__link">
    <span class="md-ellipsis">
      from_config
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.SwitchbackSplitter" class="md-nav__link">
    <span class="md-ellipsis">
      SwitchbackSplitter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SwitchbackSplitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.SwitchbackSplitter._check_clusters" class="md-nav__link">
    <span class="md-ellipsis">
      _check_clusters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.random_splitter.SwitchbackSplitter.assign_treatment_df" class="md-nav__link">
    <span class="md-ellipsis">
      assign_treatment_df
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="from-cluster_experimentsrandom_splitter-import"><code>from cluster_experiments.random_splitter import *</code><a class="headerlink" href="#from-cluster_experimentsrandom_splitter-import" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">



<a id="cluster_experiments.random_splitter"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="cluster_experiments.random_splitter.BalancedClusteredSplitter" class="doc doc-heading">
            <code>BalancedClusteredSplitter</code>


<a href="#cluster_experiments.random_splitter.BalancedClusteredSplitter" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="cluster_experiments.random_splitter.ClusteredSplitter" href="#cluster_experiments.random_splitter.ClusteredSplitter">ClusteredSplitter</a></code></p>


        <p>Like ClusteredSplitter, but ensures that treatments are balanced among clusters. That is, if we have
25 clusters and 2 treatments, 13 clusters should have treatment A and 12 clusters should have treatment B.</p>






              <details class="quote">
                <summary>Source code in <code>cluster_experiments/random_splitter.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BalancedClusteredSplitter</span><span class="p">(</span><span class="n">ClusteredSplitter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Like ClusteredSplitter, but ensures that treatments are balanced among clusters. That is, if we have</span>
<span class="sd">    25 clusters and 2 treatments, 13 clusters should have treatment A and 12 clusters should have treatment B.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_treatment</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">cluster_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Samples treatments for each cluster</span>

<span class="sd">        Arguments:</span>
<span class="sd">            cluster_df: dataframe to assign treatments to</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n_clusters</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cluster_df</span><span class="p">)</span>
        <span class="n">n_treatments</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treatments</span><span class="p">)</span>
        <span class="n">n_per_treatment</span> <span class="o">=</span> <span class="n">n_clusters</span> <span class="o">//</span> <span class="n">n_treatments</span>
        <span class="n">n_extra</span> <span class="o">=</span> <span class="n">n_clusters</span> <span class="o">%</span> <span class="n">n_treatments</span>
        <span class="n">treatments</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_treatments</span><span class="p">):</span>
            <span class="n">treatments</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">treatments</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_per_treatment</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">n_extra</span><span class="p">))</span>
        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">treatments</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">treatments</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.random_splitter.BalancedClusteredSplitter.sample_treatment" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sample_treatment</span><span class="p">(</span><span class="n">cluster_df</span><span class="p">)</span></code>

<a href="#cluster_experiments.random_splitter.BalancedClusteredSplitter.sample_treatment" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Samples treatments for each cluster</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cluster_df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dataframe to assign treatments to</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/random_splitter.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">sample_treatment</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">cluster_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Samples treatments for each cluster</span>

<span class="sd">    Arguments:</span>
<span class="sd">        cluster_df: dataframe to assign treatments to</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_clusters</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cluster_df</span><span class="p">)</span>
    <span class="n">n_treatments</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treatments</span><span class="p">)</span>
    <span class="n">n_per_treatment</span> <span class="o">=</span> <span class="n">n_clusters</span> <span class="o">//</span> <span class="n">n_treatments</span>
    <span class="n">n_extra</span> <span class="o">=</span> <span class="n">n_clusters</span> <span class="o">%</span> <span class="n">n_treatments</span>
    <span class="n">treatments</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_treatments</span><span class="p">):</span>
        <span class="n">treatments</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">treatments</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_per_treatment</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">n_extra</span><span class="p">))</span>
    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">treatments</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">treatments</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cluster_experiments.random_splitter.BalancedSwitchbackSplitter" class="doc doc-heading">
            <code>BalancedSwitchbackSplitter</code>


<a href="#cluster_experiments.random_splitter.BalancedSwitchbackSplitter" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="cluster_experiments.random_splitter.BalancedClusteredSplitter" href="#cluster_experiments.random_splitter.BalancedClusteredSplitter">BalancedClusteredSplitter</a></code>, <code><a class="autorefs autorefs-internal" title="cluster_experiments.random_splitter.SwitchbackSplitter" href="#cluster_experiments.random_splitter.SwitchbackSplitter">SwitchbackSplitter</a></code></p>


        <p>Like SwitchbackSplitter, but ensures that treatments are balanced among clusters. That is, if we have
25 clusters and 2 treatments, 13 clusters should have treatment A and 12 clusters should have treatment B.</p>






              <details class="quote">
                <summary>Source code in <code>cluster_experiments/random_splitter.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BalancedSwitchbackSplitter</span><span class="p">(</span><span class="n">BalancedClusteredSplitter</span><span class="p">,</span> <span class="n">SwitchbackSplitter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Like SwitchbackSplitter, but ensures that treatments are balanced among clusters. That is, if we have</span>
<span class="sd">    25 clusters and 2 treatments, 13 clusters should have treatment A and 12 clusters should have treatment B.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cluster_experiments.random_splitter.ClusteredSplitter" class="doc doc-heading">
            <code>ClusteredSplitter</code>


<a href="#cluster_experiments.random_splitter.ClusteredSplitter" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="cluster_experiments.random_splitter.RandomSplitter" href="#cluster_experiments.random_splitter.RandomSplitter">RandomSplitter</a></code></p>


        <p>Splits randomly using clusters</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cluster_cols</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of columns to use as clusters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>treatments</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of treatments</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>treatment_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the column with the treatment variable.</p>
              </div>
            </td>
            <td>
                  <code>&#39;treatment&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>splitter_weights</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="float">float</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>weights to use for the splitter, should have the same length as treatments, each weight should correspond to an element in treatments</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Usage:
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cluster_experiments.random_splitter</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClusteredSplitter</span>
<span class="n">splitter</span> <span class="o">=</span> <span class="n">ClusteredSplitter</span><span class="p">(</span><span class="n">cluster_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;city&quot;</span><span class="p">])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;city&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">]})</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">splitter</span><span class="o">.</span><span class="n">assign_treatment_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div></p>






              <details class="quote">
                <summary>Source code in <code>cluster_experiments/random_splitter.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ClusteredSplitter</span><span class="p">(</span><span class="n">RandomSplitter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Splits randomly using clusters</span>

<span class="sd">    Arguments:</span>
<span class="sd">        cluster_cols: List of columns to use as clusters</span>
<span class="sd">        treatments: list of treatments</span>
<span class="sd">        treatment_col: Name of the column with the treatment variable.</span>
<span class="sd">        splitter_weights: weights to use for the splitter, should have the same length as treatments, each weight should correspond to an element in treatments</span>

<span class="sd">    Usage:</span>
<span class="sd">    ```python</span>
<span class="sd">    import pandas as pd</span>
<span class="sd">    from cluster_experiments.random_splitter import ClusteredSplitter</span>
<span class="sd">    splitter = ClusteredSplitter(cluster_cols=[&quot;city&quot;])</span>
<span class="sd">    df = pd.DataFrame({&quot;city&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;C&quot;]})</span>
<span class="sd">    df = splitter.assign_treatment_df(df)</span>
<span class="sd">    print(df)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">cluster_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">treatments</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;treatment&quot;</span><span class="p">,</span>
        <span class="n">splitter_weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treatments</span> <span class="o">=</span> <span class="n">treatments</span> <span class="ow">or</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cluster_cols</span> <span class="o">=</span> <span class="n">cluster_cols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span> <span class="o">=</span> <span class="n">treatment_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splitter_weights</span> <span class="o">=</span> <span class="n">splitter_weights</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">assign_treatment_df</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Takes a df, randomizes treatments and adds the treatment column to the dataframe</span>

<span class="sd">        Arguments:</span>
<span class="sd">            df: dataframe to assign treatments to</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># raise error if any nulls in cluster_cols</span>
        <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cluster_cols</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Null values found in cluster_cols: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cluster_cols</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="s2">&quot;Please remove nulls before running the splitter.&quot;</span>
            <span class="p">)</span>

        <span class="n">clusters_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cluster_cols</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
        <span class="n">clusters_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_treatment</span><span class="p">(</span><span class="n">clusters_df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">clusters_df</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cluster_cols</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_treatment</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">cluster_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Samples treatments for each cluster</span>

<span class="sd">        Arguments:</span>
<span class="sd">            cluster_df: dataframe to assign treatments to</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">treatments</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">cluster_df</span><span class="p">),</span> <span class="n">weights</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">splitter_weights</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.random_splitter.ClusteredSplitter.assign_treatment_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">assign_treatment_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></code>

<a href="#cluster_experiments.random_splitter.ClusteredSplitter.assign_treatment_df" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Takes a df, randomizes treatments and adds the treatment column to the dataframe</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dataframe to assign treatments to</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/random_splitter.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">assign_treatment_df</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes a df, randomizes treatments and adds the treatment column to the dataframe</span>

<span class="sd">    Arguments:</span>
<span class="sd">        df: dataframe to assign treatments to</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># raise error if any nulls in cluster_cols</span>
    <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cluster_cols</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Null values found in cluster_cols: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cluster_cols</span><span class="si">}</span><span class="s2">. &quot;</span>
            <span class="s2">&quot;Please remove nulls before running the splitter.&quot;</span>
        <span class="p">)</span>

    <span class="n">clusters_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cluster_cols</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
    <span class="n">clusters_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_treatment</span><span class="p">(</span><span class="n">clusters_df</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">clusters_df</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cluster_cols</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.random_splitter.ClusteredSplitter.sample_treatment" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sample_treatment</span><span class="p">(</span><span class="n">cluster_df</span><span class="p">)</span></code>

<a href="#cluster_experiments.random_splitter.ClusteredSplitter.sample_treatment" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Samples treatments for each cluster</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cluster_df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dataframe to assign treatments to</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/random_splitter.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">sample_treatment</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">cluster_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Samples treatments for each cluster</span>

<span class="sd">    Arguments:</span>
<span class="sd">        cluster_df: dataframe to assign treatments to</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treatments</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">cluster_df</span><span class="p">),</span> <span class="n">weights</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">splitter_weights</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cluster_experiments.random_splitter.FixedSizeClusteredSplitter" class="doc doc-heading">
            <code>FixedSizeClusteredSplitter</code>


<a href="#cluster_experiments.random_splitter.FixedSizeClusteredSplitter" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="cluster_experiments.random_splitter.ClusteredSplitter" href="#cluster_experiments.random_splitter.ClusteredSplitter">ClusteredSplitter</a></code></p>


        <p>This class  represents a splitter that splits clusters into treatment groups with a predefined number of
treatment clusters. This is particularly useful for synthetic control analysis, where we only want 1 cluster (
unit) to be in treatment group and the rest in control The cluster that receives treatment remains random.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="cluster_experiments.random_splitter.FixedSizeClusteredSplitter.cluster_cols">cluster_cols</span></code></td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of columns to use as clusters.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="cluster_experiments.random_splitter.FixedSizeClusteredSplitter.n_treatment_clusters">n_treatment_clusters</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The predefined number of treatment clusters.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>cluster_experiments/random_splitter.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FixedSizeClusteredSplitter</span><span class="p">(</span><span class="n">ClusteredSplitter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class  represents a splitter that splits clusters into treatment groups with a predefined number of</span>
<span class="sd">    treatment clusters. This is particularly useful for synthetic control analysis, where we only want 1 cluster (</span>
<span class="sd">    unit) to be in treatment group and the rest in control The cluster that receives treatment remains random.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        cluster_cols (List[str]): List of columns to use as clusters.</span>
<span class="sd">        n_treatment_clusters (int): The predefined number of treatment clusters.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">n_treatment_clusters</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">cluster_cols</span><span class="o">=</span><span class="n">cluster_cols</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_treatment_clusters</span> <span class="o">=</span> <span class="n">n_treatment_clusters</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_treatment</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">cluster_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Samples treatments for each cluster.</span>

<span class="sd">        Args:</span>
<span class="sd">            cluster_df (pd.DataFrame): Dataframe to assign treatments to.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[str]: A list of treatments for each cluster.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n_control_treatment</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">cluster_df</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_treatment_clusters</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_treatment_clusters</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">sample_treatment</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">treatment</span>
            <span class="k">for</span> <span class="n">treatment</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treatments</span><span class="p">,</span> <span class="n">n_control_treatment</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">sample_treatment</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sample_treatment</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.random_splitter.FixedSizeClusteredSplitter.sample_treatment" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sample_treatment</span><span class="p">(</span><span class="n">cluster_df</span><span class="p">)</span></code>

<a href="#cluster_experiments.random_splitter.FixedSizeClusteredSplitter.sample_treatment" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Samples treatments for each cluster.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cluster_df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataframe to assign treatments to.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[str]: A list of treatments for each cluster.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/random_splitter.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">sample_treatment</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">cluster_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Samples treatments for each cluster.</span>

<span class="sd">    Args:</span>
<span class="sd">        cluster_df (pd.DataFrame): Dataframe to assign treatments to.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: A list of treatments for each cluster.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_control_treatment</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">cluster_df</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_treatment_clusters</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_treatment_clusters</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">sample_treatment</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">treatment</span>
        <span class="k">for</span> <span class="n">treatment</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treatments</span><span class="p">,</span> <span class="n">n_control_treatment</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">sample_treatment</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sample_treatment</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cluster_experiments.random_splitter.NonClusteredSplitter" class="doc doc-heading">
            <code>NonClusteredSplitter</code>


<a href="#cluster_experiments.random_splitter.NonClusteredSplitter" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="cluster_experiments.random_splitter.RandomSplitter" href="#cluster_experiments.random_splitter.RandomSplitter">RandomSplitter</a></code></p>


        <p>Splits randomly without clusters</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>treatments</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of treatments</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>treatment_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the column with the treatment variable.</p>
              </div>
            </td>
            <td>
                  <code>&#39;treatment&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Usage:
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cluster_experiments.random_splitter</span><span class="w"> </span><span class="kn">import</span> <span class="n">NonClusteredSplitter</span>
<span class="n">splitter</span> <span class="o">=</span> <span class="n">NonClusteredSplitter</span><span class="p">(</span>
    <span class="n">treatments</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;city&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">]})</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">splitter</span><span class="o">.</span><span class="n">assign_treatment_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div></p>






              <details class="quote">
                <summary>Source code in <code>cluster_experiments/random_splitter.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">NonClusteredSplitter</span><span class="p">(</span><span class="n">RandomSplitter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Splits randomly without clusters</span>

<span class="sd">    Arguments:</span>
<span class="sd">        treatments: list of treatments</span>
<span class="sd">        treatment_col: Name of the column with the treatment variable.</span>

<span class="sd">    Usage:</span>
<span class="sd">    ```python</span>
<span class="sd">    import pandas as pd</span>
<span class="sd">    from cluster_experiments.random_splitter import NonClusteredSplitter</span>
<span class="sd">    splitter = NonClusteredSplitter(</span>
<span class="sd">        treatments=[&quot;A&quot;, &quot;B&quot;],</span>
<span class="sd">    )</span>
<span class="sd">    df = pd.DataFrame({&quot;city&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;C&quot;]})</span>
<span class="sd">    df = splitter.assign_treatment_df(df)</span>
<span class="sd">    print(df)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">treatments</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;treatment&quot;</span><span class="p">,</span>
        <span class="n">splitter_weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treatments</span> <span class="o">=</span> <span class="n">treatments</span> <span class="ow">or</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span> <span class="o">=</span> <span class="n">treatment_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splitter_weights</span> <span class="o">=</span> <span class="n">splitter_weights</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">assign_treatment_df</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Takes a df, randomizes treatments and adds the treatment column to the dataframe</span>

<span class="sd">        Arguments:</span>
<span class="sd">            df: dataframe to assign treatments to</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">treatments</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">weights</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">splitter_weights</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a NonClusteredSplitter from a PowerConfig&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">treatments</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatments</span><span class="p">,</span>
            <span class="n">treatment_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">,</span>
            <span class="n">splitter_weights</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">splitter_weights</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.random_splitter.NonClusteredSplitter.assign_treatment_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">assign_treatment_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></code>

<a href="#cluster_experiments.random_splitter.NonClusteredSplitter.assign_treatment_df" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Takes a df, randomizes treatments and adds the treatment column to the dataframe</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dataframe to assign treatments to</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/random_splitter.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">assign_treatment_df</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes a df, randomizes treatments and adds the treatment column to the dataframe</span>

<span class="sd">    Arguments:</span>
<span class="sd">        df: dataframe to assign treatments to</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treatments</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">weights</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">splitter_weights</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.random_splitter.NonClusteredSplitter.from_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#cluster_experiments.random_splitter.NonClusteredSplitter.from_config" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Creates a NonClusteredSplitter from a PowerConfig</p>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/random_splitter.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a NonClusteredSplitter from a PowerConfig&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">treatments</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatments</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">,</span>
        <span class="n">splitter_weights</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">splitter_weights</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cluster_experiments.random_splitter.RandomSplitter" class="doc doc-heading">
            <code>RandomSplitter</code>


<a href="#cluster_experiments.random_splitter.RandomSplitter" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>Abstract class to split instances in a switchback or clustered way. It can be used to create a calendar/split of clusters
or to run a power analysis.</p>
<p>In order to create your own RandomSplitter, you should write your own assign_treatment_df method, that takes a dataframe as an input and returns the same dataframe with the treatment_col column.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cluster_cols</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of columns to use as clusters</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>treatments</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of treatments</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>treatment_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the column with the treatment variable.</p>
              </div>
            </td>
            <td>
                  <code>&#39;treatment&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>splitter_weights</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="float">float</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>weights to use for the splitter, should have the same length as treatments, each weight should correspond to an element in treatments</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>cluster_experiments/random_splitter.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RandomSplitter</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract class to split instances in a switchback or clustered way. It can be used to create a calendar/split of clusters</span>
<span class="sd">    or to run a power analysis.</span>

<span class="sd">    In order to create your own RandomSplitter, you should write your own assign_treatment_df method, that takes a dataframe as an input and returns the same dataframe with the treatment_col column.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        cluster_cols: List of columns to use as clusters</span>
<span class="sd">        treatments: list of treatments</span>
<span class="sd">        treatment_col: Name of the column with the treatment variable.</span>
<span class="sd">        splitter_weights: weights to use for the splitter, should have the same length as treatments, each weight should correspond to an element in treatments</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">cluster_cols</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">treatments</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;treatment&quot;</span><span class="p">,</span>
        <span class="n">splitter_weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treatments</span> <span class="o">=</span> <span class="n">treatments</span> <span class="ow">or</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cluster_cols</span> <span class="o">=</span> <span class="n">cluster_cols</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span> <span class="o">=</span> <span class="n">treatment_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splitter_weights</span> <span class="o">=</span> <span class="n">splitter_weights</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">assign_treatment_df</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Takes a df, randomizes treatments and adds the treatment column to the dataframe</span>

<span class="sd">        Arguments:</span>
<span class="sd">            df: dataframe to assign treatments to</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a RandomSplitter from a PowerConfig&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">treatments</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatments</span><span class="p">,</span>
            <span class="n">cluster_cols</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">cluster_cols</span><span class="p">,</span>
            <span class="n">treatment_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">,</span>
            <span class="n">splitter_weights</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">splitter_weights</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.random_splitter.RandomSplitter.assign_treatment_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">assign_treatment_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#cluster_experiments.random_splitter.RandomSplitter.assign_treatment_df" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Takes a df, randomizes treatments and adds the treatment column to the dataframe</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dataframe to assign treatments to</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/random_splitter.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">assign_treatment_df</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes a df, randomizes treatments and adds the treatment column to the dataframe</span>

<span class="sd">    Arguments:</span>
<span class="sd">        df: dataframe to assign treatments to</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.random_splitter.RandomSplitter.from_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#cluster_experiments.random_splitter.RandomSplitter.from_config" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Creates a RandomSplitter from a PowerConfig</p>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/random_splitter.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a RandomSplitter from a PowerConfig&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">treatments</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatments</span><span class="p">,</span>
        <span class="n">cluster_cols</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">cluster_cols</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">,</span>
        <span class="n">splitter_weights</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">splitter_weights</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cluster_experiments.random_splitter.RepeatedSampler" class="doc doc-heading">
            <code>RepeatedSampler</code>


<a href="#cluster_experiments.random_splitter.RepeatedSampler" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="cluster_experiments.random_splitter.RandomSplitter" href="#cluster_experiments.random_splitter.RandomSplitter">RandomSplitter</a></code></p>


        <p>Doesn't actually split the data, but repeatedly samples (i.e. duplicates) all rows for all treatments.
This is useful for backtesting, where we assume to have access to all counterfactuals.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>treatments</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of treatments</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>treatment_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the column with the treatment variable.</p>
              </div>
            </td>
            <td>
                  <code>&#39;treatment&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Usage:
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cluster_experiments.random_splitter</span><span class="w"> </span><span class="kn">import</span> <span class="n">RepeatedSampler</span>
<span class="n">splitter</span> <span class="o">=</span> <span class="n">RepeatedSampler</span><span class="p">(</span>
    <span class="n">treatments</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;city&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">]})</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">splitter</span><span class="o">.</span><span class="n">assign_treatment_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div></p>






              <details class="quote">
                <summary>Source code in <code>cluster_experiments/random_splitter.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RepeatedSampler</span><span class="p">(</span><span class="n">RandomSplitter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Doesn&#39;t actually split the data, but repeatedly samples (i.e. duplicates) all rows for all treatments.</span>
<span class="sd">    This is useful for backtesting, where we assume to have access to all counterfactuals.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        treatments: list of treatments</span>
<span class="sd">        treatment_col: Name of the column with the treatment variable.</span>

<span class="sd">    Usage:</span>
<span class="sd">    ```python</span>
<span class="sd">    import pandas as pd</span>
<span class="sd">    from cluster_experiments.random_splitter import RepeatedSampler</span>
<span class="sd">    splitter = RepeatedSampler(</span>
<span class="sd">        treatments=[&quot;A&quot;, &quot;B&quot;],</span>
<span class="sd">    )</span>
<span class="sd">    df = pd.DataFrame({&quot;city&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;C&quot;]})</span>
<span class="sd">    df = splitter.assign_treatment_df(df)</span>
<span class="sd">    print(df)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">treatments</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;treatment&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treatments</span> <span class="o">=</span> <span class="n">treatments</span> <span class="ow">or</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span> <span class="o">=</span> <span class="n">treatment_col</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">assign_treatment_df</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">treatment</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">treatments</span><span class="p">:</span>
            <span class="n">df_treat</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">:</span> <span class="n">treatment</span><span class="p">})</span>
            <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_treat</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a RepeatedSampler from a PowerConfig&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">treatments</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatments</span><span class="p">,</span>
            <span class="n">treatment_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.random_splitter.RepeatedSampler.from_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#cluster_experiments.random_splitter.RepeatedSampler.from_config" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Creates a RepeatedSampler from a PowerConfig</p>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/random_splitter.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a RepeatedSampler from a PowerConfig&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">treatments</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatments</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cluster_experiments.random_splitter.StratifiedClusteredSplitter" class="doc doc-heading">
            <code>StratifiedClusteredSplitter</code>


<a href="#cluster_experiments.random_splitter.StratifiedClusteredSplitter" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="cluster_experiments.random_splitter.RandomSplitter" href="#cluster_experiments.random_splitter.RandomSplitter">RandomSplitter</a></code></p>


        <p>Splits randomly with clusters, ensuring a balanced allocation of treatment groups across clusters and strata.
To be used, for example, when having days as clusters and days of the week as stratus. This splitter will make sure
that we won't have all Sundays in treatment and no Sundays in control.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cluster_cols</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of columns to use as clusters</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>treatments</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of treatments</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>treatment_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the column with the treatment variable.</p>
              </div>
            </td>
            <td>
                  <code>&#39;treatment&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>strata_cols</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of columns to use as strata</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Usage:
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cluster_experiments.random_splitter</span><span class="w"> </span><span class="kn">import</span> <span class="n">StratifiedClusteredSplitter</span>
<span class="n">splitter</span> <span class="o">=</span> <span class="n">StratifiedClusteredSplitter</span><span class="p">(</span><span class="n">cluster_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;city&quot;</span><span class="p">],</span><span class="n">strata_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;city&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span><span class="s2">&quot;D&quot;</span><span class="p">],</span> <span class="s2">&quot;country&quot;</span><span class="p">:[</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span><span class="s2">&quot;C1&quot;</span><span class="p">]})</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">splitter</span><span class="o">.</span><span class="n">assign_treatment_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div></p>






              <details class="quote">
                <summary>Source code in <code>cluster_experiments/random_splitter.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">StratifiedClusteredSplitter</span><span class="p">(</span><span class="n">RandomSplitter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Splits randomly with clusters, ensuring a balanced allocation of treatment groups across clusters and strata.</span>
<span class="sd">    To be used, for example, when having days as clusters and days of the week as stratus. This splitter will make sure</span>
<span class="sd">    that we won&#39;t have all Sundays in treatment and no Sundays in control.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        cluster_cols: List of columns to use as clusters</span>
<span class="sd">        treatments: list of treatments</span>
<span class="sd">        treatment_col: Name of the column with the treatment variable.</span>
<span class="sd">        strata_cols: List of columns to use as strata</span>

<span class="sd">    Usage:</span>
<span class="sd">    ```python</span>
<span class="sd">    import pandas as pd</span>
<span class="sd">    from cluster_experiments.random_splitter import StratifiedClusteredSplitter</span>
<span class="sd">    splitter = StratifiedClusteredSplitter(cluster_cols=[&quot;city&quot;],strata_cols=[&quot;country&quot;])</span>
<span class="sd">    df = pd.DataFrame({&quot;city&quot;: [&quot;A&quot;, &quot;B&quot;, &quot;C&quot;,&quot;D&quot;], &quot;country&quot;:[&quot;C1&quot;,&quot;C2&quot;,&quot;C2&quot;,&quot;C1&quot;]})</span>
<span class="sd">    df = splitter.assign_treatment_df(df)</span>
<span class="sd">    print(df)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">cluster_cols</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">treatments</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;treatment&quot;</span><span class="p">,</span>
        <span class="n">strata_cols</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">cluster_cols</span><span class="o">=</span><span class="n">cluster_cols</span><span class="p">,</span>
            <span class="n">treatments</span><span class="o">=</span><span class="n">treatments</span><span class="p">,</span>
            <span class="n">treatment_col</span><span class="o">=</span><span class="n">treatment_col</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">strata_cols</span> <span class="ow">or</span> <span class="n">strata_cols</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Splitter </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> requires strata_cols,&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; got </span><span class="si">{</span><span class="n">strata_cols</span><span class="w"> </span><span class="si">= }</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strata_cols</span> <span class="o">=</span> <span class="n">strata_cols</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">assign_treatment_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">df_unique_shuffled</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cluster_cols</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">strata_cols</span><span class="p">))]</span>
            <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
            <span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># check that, for a given cluster, there is only 1 strata</span>
        <span class="k">for</span> <span class="n">strata_col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">strata_cols</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">df_unique_shuffled</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cluster_cols</span><span class="p">)[</span><span class="n">strata_col</span><span class="p">]</span>
                <span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
                <span class="o">.</span><span class="n">max</span><span class="p">()</span>
                <span class="o">&gt;</span> <span class="mi">1</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;There are multiple values in </span><span class="si">{</span><span class="n">strata_col</span><span class="si">}</span><span class="s2"> for the same cluster item </span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;You cannot stratify on this column&quot;</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># random shuffling</span>
        <span class="n">random_sorted_treatments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treatments</span><span class="p">))</span>

        <span class="n">df_unique_shuffled</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">df_unique_shuffled</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strata_cols</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="o">.</span><span class="n">cumcount</span><span class="p">()</span>
            <span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">random_sorted_treatments</span><span class="p">))</span>
            <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">random_sorted_treatments</span><span class="p">)))</span>
        <span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">df_unique_shuffled</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cluster_cols</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">strata_cols</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a StratifiedClusteredSplitter from a PowerConfig&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">treatments</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatments</span><span class="p">,</span>
            <span class="n">cluster_cols</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">cluster_cols</span><span class="p">,</span>
            <span class="n">strata_cols</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">strata_cols</span><span class="p">,</span>
            <span class="n">treatment_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.random_splitter.StratifiedClusteredSplitter.from_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#cluster_experiments.random_splitter.StratifiedClusteredSplitter.from_config" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Creates a StratifiedClusteredSplitter from a PowerConfig</p>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/random_splitter.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a StratifiedClusteredSplitter from a PowerConfig&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">treatments</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatments</span><span class="p">,</span>
        <span class="n">cluster_cols</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">cluster_cols</span><span class="p">,</span>
        <span class="n">strata_cols</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">strata_cols</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cluster_experiments.random_splitter.StratifiedSwitchbackSplitter" class="doc doc-heading">
            <code>StratifiedSwitchbackSplitter</code>


<a href="#cluster_experiments.random_splitter.StratifiedSwitchbackSplitter" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="cluster_experiments.random_splitter.StratifiedClusteredSplitter" href="#cluster_experiments.random_splitter.StratifiedClusteredSplitter">StratifiedClusteredSplitter</a></code>, <code><a class="autorefs autorefs-internal" title="cluster_experiments.random_splitter.SwitchbackSplitter" href="#cluster_experiments.random_splitter.SwitchbackSplitter">SwitchbackSplitter</a></code></p>


        <p>Splits randomly with clusters, ensuring a balanced allocation of treatment groups across clusters and strata.
To be used, for example, when having days as clusters and days of the week as stratus. This splitter will make sure
that we won't have all Sundays in treatment and no Sundays in control.</p>
<p>It can be created using the time_col and switch_frequency arguments, just like the SwitchbackSplitter.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>time_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the column with the time variable.</p>
              </div>
            </td>
            <td>
                  <code>&#39;date&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>switch_frequency</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Frequency of the switchback. Must be a string (e.g. "1D")</p>
              </div>
            </td>
            <td>
                  <code>&#39;1D&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cluster_cols</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of columns to use as clusters</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>treatments</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of treatments</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>treatment_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the column with the treatment variable.</p>
              </div>
            </td>
            <td>
                  <code>&#39;treatment&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>splitter_weights</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="float">float</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of weights for the treatments. If None, all treatments will have the same weight.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>strata_cols</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of columns to use as strata</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Usage:
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cluster_experiments.random_splitter</span><span class="w"> </span><span class="kn">import</span> <span class="n">StratifiedSwitchbackSplitter</span>
<span class="n">splitter</span> <span class="o">=</span> <span class="n">StratifiedSwitchbackSplitter</span><span class="p">(</span><span class="n">time_col</span><span class="o">=</span><span class="s2">&quot;date&quot;</span><span class="p">,</span><span class="n">switch_frequency</span><span class="o">=</span><span class="s2">&quot;1D&quot;</span><span class="p">,</span><span class="n">strata_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">],</span> <span class="n">cluster_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;2020-01-01&quot;</span><span class="p">,</span> <span class="s2">&quot;2020-01-02&quot;</span><span class="p">,</span> <span class="s2">&quot;2020-01-03&quot;</span><span class="p">,</span><span class="s2">&quot;2020-01-04&quot;</span><span class="p">],</span> <span class="s2">&quot;country&quot;</span><span class="p">:[</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span><span class="s2">&quot;C1&quot;</span><span class="p">]})</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">splitter</span><span class="o">.</span><span class="n">assign_treatment_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div></p>






              <details class="quote">
                <summary>Source code in <code>cluster_experiments/random_splitter.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">StratifiedSwitchbackSplitter</span><span class="p">(</span><span class="n">StratifiedClusteredSplitter</span><span class="p">,</span> <span class="n">SwitchbackSplitter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Splits randomly with clusters, ensuring a balanced allocation of treatment groups across clusters and strata.</span>
<span class="sd">    To be used, for example, when having days as clusters and days of the week as stratus. This splitter will make sure</span>
<span class="sd">    that we won&#39;t have all Sundays in treatment and no Sundays in control.</span>

<span class="sd">    It can be created using the time_col and switch_frequency arguments, just like the SwitchbackSplitter.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        time_col: Name of the column with the time variable.</span>
<span class="sd">        switch_frequency: Frequency of the switchback. Must be a string (e.g. &quot;1D&quot;)</span>
<span class="sd">        cluster_cols: List of columns to use as clusters</span>
<span class="sd">        treatments: list of treatments</span>
<span class="sd">        treatment_col: Name of the column with the treatment variable.</span>
<span class="sd">        splitter_weights: List of weights for the treatments. If None, all treatments will have the same weight.</span>
<span class="sd">        strata_cols: List of columns to use as strata</span>

<span class="sd">    Usage:</span>
<span class="sd">    ```python</span>
<span class="sd">    import pandas as pd</span>
<span class="sd">    from cluster_experiments.random_splitter import StratifiedSwitchbackSplitter</span>
<span class="sd">    splitter = StratifiedSwitchbackSplitter(time_col=&quot;date&quot;,switch_frequency=&quot;1D&quot;,strata_cols=[&quot;country&quot;], cluster_cols=[&quot;country&quot;, &quot;date&quot;])</span>
<span class="sd">    df = pd.DataFrame({&quot;date&quot;: [&quot;2020-01-01&quot;, &quot;2020-01-02&quot;, &quot;2020-01-03&quot;,&quot;2020-01-04&quot;], &quot;country&quot;:[&quot;C1&quot;,&quot;C2&quot;,&quot;C2&quot;,&quot;C1&quot;]})</span>
<span class="sd">    df = splitter.assign_treatment_df(df)</span>
<span class="sd">    print(df)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">time_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span>
        <span class="n">switch_frequency</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;1D&quot;</span><span class="p">,</span>
        <span class="n">cluster_cols</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">treatments</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;treatment&quot;</span><span class="p">,</span>
        <span class="n">splitter_weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">washover</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Washover</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">strata_cols</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Inherit init from SwitchbackSplitter</span>
        <span class="n">SwitchbackSplitter</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">time_col</span><span class="o">=</span><span class="n">time_col</span><span class="p">,</span>
            <span class="n">switch_frequency</span><span class="o">=</span><span class="n">switch_frequency</span><span class="p">,</span>
            <span class="n">cluster_cols</span><span class="o">=</span><span class="n">cluster_cols</span><span class="p">,</span>
            <span class="n">treatments</span><span class="o">=</span><span class="n">treatments</span><span class="p">,</span>
            <span class="n">treatment_col</span><span class="o">=</span><span class="n">treatment_col</span><span class="p">,</span>
            <span class="n">splitter_weights</span><span class="o">=</span><span class="n">splitter_weights</span><span class="p">,</span>
            <span class="n">washover</span><span class="o">=</span><span class="n">washover</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strata_cols</span> <span class="o">=</span> <span class="n">strata_cols</span> <span class="ow">or</span> <span class="p">[</span><span class="s2">&quot;strata&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">assign_treatment_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_switchback_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">StratifiedClusteredSplitter</span><span class="o">.</span><span class="n">assign_treatment_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">washover</span><span class="o">.</span><span class="n">washover</span><span class="p">(</span>
            <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
            <span class="n">treatment_col</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">,</span>
            <span class="n">truncated_time_col</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_col</span><span class="p">,</span>
            <span class="n">cluster_cols</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cluster_cols</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;StratifiedSwitchbackSplitter&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a StratifiedSwitchbackSplitter from a PowerConfig&quot;&quot;&quot;</span>
        <span class="n">washover_cls</span> <span class="o">=</span> <span class="n">_get_mapping_key</span><span class="p">(</span><span class="n">washover_mapping</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">washover</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">treatments</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatments</span><span class="p">,</span>
            <span class="n">cluster_cols</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">cluster_cols</span><span class="p">,</span>
            <span class="n">strata_cols</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">strata_cols</span><span class="p">,</span>
            <span class="n">treatment_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">,</span>
            <span class="n">time_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">time_col</span><span class="p">,</span>
            <span class="n">switch_frequency</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">switch_frequency</span><span class="p">,</span>
            <span class="n">splitter_weights</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">splitter_weights</span><span class="p">,</span>
            <span class="n">washover</span><span class="o">=</span><span class="n">washover_cls</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="n">config</span><span class="p">),</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.random_splitter.StratifiedSwitchbackSplitter.from_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#cluster_experiments.random_splitter.StratifiedSwitchbackSplitter.from_config" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Creates a StratifiedSwitchbackSplitter from a PowerConfig</p>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/random_splitter.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;StratifiedSwitchbackSplitter&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a StratifiedSwitchbackSplitter from a PowerConfig&quot;&quot;&quot;</span>
    <span class="n">washover_cls</span> <span class="o">=</span> <span class="n">_get_mapping_key</span><span class="p">(</span><span class="n">washover_mapping</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">washover</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">treatments</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatments</span><span class="p">,</span>
        <span class="n">cluster_cols</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">cluster_cols</span><span class="p">,</span>
        <span class="n">strata_cols</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">strata_cols</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">,</span>
        <span class="n">time_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">time_col</span><span class="p">,</span>
        <span class="n">switch_frequency</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">switch_frequency</span><span class="p">,</span>
        <span class="n">splitter_weights</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">splitter_weights</span><span class="p">,</span>
        <span class="n">washover</span><span class="o">=</span><span class="n">washover_cls</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="n">config</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cluster_experiments.random_splitter.SwitchbackSplitter" class="doc doc-heading">
            <code>SwitchbackSplitter</code>


<a href="#cluster_experiments.random_splitter.SwitchbackSplitter" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="cluster_experiments.random_splitter.ClusteredSplitter" href="#cluster_experiments.random_splitter.ClusteredSplitter">ClusteredSplitter</a></code></p>


        <p>Splits randomly using clusters and time column</p>
<p>It is a clustered splitter but one of the cluster columns is obtained by truncating the time column to the switch frequency.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>time_col</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the column with the time variable.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>switch_frequency</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Frequency to switch treatments. Uses pandas frequency aliases (https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#offset-aliases)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cluster_cols</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of columns to use as clusters</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>treatments</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of treatments</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>treatment_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the column with the treatment variable.</p>
              </div>
            </td>
            <td>
                  <code>&#39;treatment&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>splitter_weights</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="float">float</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>weights to use for the splitter, should have the same length as treatments, each weight should correspond to an element in treatments</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Usage:
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cluster_experiments.random_splitter</span><span class="w"> </span><span class="kn">import</span> <span class="n">SwitchbackSplitter</span>
<span class="n">splitter</span> <span class="o">=</span> <span class="n">SwitchbackSplitter</span><span class="p">(</span><span class="n">time_col</span><span class="o">=</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="n">switch_frequency</span><span class="o">=</span><span class="s2">&quot;1D&quot;</span><span class="p">,</span> <span class="n">cluster_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">&quot;2020-01-01&quot;</span><span class="p">,</span> <span class="s2">&quot;2020-01-03&quot;</span><span class="p">)})</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">splitter</span><span class="o">.</span><span class="n">assign_treatment_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div></p>






              <details class="quote">
                <summary>Source code in <code>cluster_experiments/random_splitter.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SwitchbackSplitter</span><span class="p">(</span><span class="n">ClusteredSplitter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Splits randomly using clusters and time column</span>

<span class="sd">    It is a clustered splitter but one of the cluster columns is obtained by truncating the time column to the switch frequency.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        time_col: Name of the column with the time variable.</span>
<span class="sd">        switch_frequency: Frequency to switch treatments. Uses pandas frequency aliases (https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#offset-aliases)</span>
<span class="sd">        cluster_cols: List of columns to use as clusters</span>
<span class="sd">        treatments: list of treatments</span>
<span class="sd">        treatment_col: Name of the column with the treatment variable.</span>
<span class="sd">        splitter_weights: weights to use for the splitter, should have the same length as treatments, each weight should correspond to an element in treatments</span>

<span class="sd">    Usage:</span>
<span class="sd">    ```python</span>
<span class="sd">    import pandas as pd</span>
<span class="sd">    from cluster_experiments.random_splitter import SwitchbackSplitter</span>
<span class="sd">    splitter = SwitchbackSplitter(time_col=&quot;date&quot;, switch_frequency=&quot;1D&quot;, cluster_cols=[&quot;date&quot;])</span>
<span class="sd">    df = pd.DataFrame({&quot;date&quot;: pd.date_range(&quot;2020-01-01&quot;, &quot;2020-01-03&quot;)})</span>
<span class="sd">    df = splitter.assign_treatment_df(df)</span>
<span class="sd">    print(df)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">time_col</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">switch_frequency</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cluster_cols</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">treatments</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;treatment&quot;</span><span class="p">,</span>
        <span class="n">splitter_weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">washover</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Washover</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_col</span> <span class="o">=</span> <span class="n">time_col</span> <span class="ow">or</span> <span class="s2">&quot;date&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">switch_frequency</span> <span class="o">=</span> <span class="n">switch_frequency</span> <span class="ow">or</span> <span class="s2">&quot;1D&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cluster_cols</span> <span class="o">=</span> <span class="n">cluster_cols</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treatments</span> <span class="o">=</span> <span class="n">treatments</span> <span class="ow">or</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span> <span class="o">=</span> <span class="n">treatment_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splitter_weights</span> <span class="o">=</span> <span class="n">splitter_weights</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">washover</span> <span class="o">=</span> <span class="n">washover</span> <span class="ow">or</span> <span class="n">EmptyWashover</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_clusters</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_clusters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if time_col is in cluster_cols&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cluster_cols</span>
        <span class="p">),</span> <span class="s2">&quot;in switchback splitters, time_col must be in cluster_cols&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_time_col_cluster</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">time_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">time_col</span><span class="p">])</span>
        <span class="c1"># Given the switch frequency, truncate the time column to the switch frequency</span>
        <span class="c1"># Using pandas frequency aliases: https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#offset-aliases</span>
        <span class="k">if</span> <span class="s2">&quot;W&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_frequency</span> <span class="ow">or</span> <span class="s2">&quot;M&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_frequency</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">time_col</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">switch_frequency</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">start_time</span>
        <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">time_col</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">switch_frequency</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_prepare_switchback_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># Build time_col switchback column</span>
        <span class="c1"># Overwriting column, this is the worst! If we use the column as a covariate, we&#39;re screwed. Needs improvement</span>
        <span class="n">df</span><span class="p">[</span><span class="n">_original_time_column</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_col</span><span class="p">)]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">time_col</span><span class="p">]</span>
        <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">time_col</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_time_col_cluster</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">assign_treatment_df</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the switchback column, adds it to cluster_cols and then calls ClusteredSplitter assign_treatment_df</span>

<span class="sd">        Arguments:</span>
<span class="sd">            df: dataframe to assign treatments to</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_switchback_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">assign_treatment_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">washover</span><span class="o">.</span><span class="n">washover</span><span class="p">(</span>
            <span class="n">df</span><span class="p">,</span>
            <span class="n">truncated_time_col</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_col</span><span class="p">,</span>
            <span class="n">treatment_col</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">,</span>
            <span class="n">cluster_cols</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cluster_cols</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;SwitchbackSplitter&quot;</span><span class="p">:</span>
        <span class="n">washover_cls</span> <span class="o">=</span> <span class="n">_get_mapping_key</span><span class="p">(</span><span class="n">washover_mapping</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">washover</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">time_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">time_col</span><span class="p">,</span>
            <span class="n">switch_frequency</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">switch_frequency</span><span class="p">,</span>
            <span class="n">cluster_cols</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">cluster_cols</span><span class="p">,</span>
            <span class="n">treatments</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatments</span><span class="p">,</span>
            <span class="n">treatment_col</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">,</span>
            <span class="n">splitter_weights</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">splitter_weights</span><span class="p">,</span>
            <span class="n">washover</span><span class="o">=</span><span class="n">washover_cls</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="n">config</span><span class="p">),</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.random_splitter.SwitchbackSplitter._check_clusters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_check_clusters</span><span class="p">()</span></code>

<a href="#cluster_experiments.random_splitter.SwitchbackSplitter._check_clusters" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Check if time_col is in cluster_cols</p>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/random_splitter.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_check_clusters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if time_col is in cluster_cols&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cluster_cols</span>
    <span class="p">),</span> <span class="s2">&quot;in switchback splitters, time_col must be in cluster_cols&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.random_splitter.SwitchbackSplitter.assign_treatment_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">assign_treatment_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></code>

<a href="#cluster_experiments.random_splitter.SwitchbackSplitter.assign_treatment_df" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Creates the switchback column, adds it to cluster_cols and then calls ClusteredSplitter assign_treatment_df</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dataframe to assign treatments to</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/random_splitter.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">assign_treatment_df</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates the switchback column, adds it to cluster_cols and then calls ClusteredSplitter assign_treatment_df</span>

<span class="sd">    Arguments:</span>
<span class="sd">        df: dataframe to assign treatments to</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_switchback_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">assign_treatment_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">washover</span><span class="o">.</span><span class="n">washover</span><span class="p">(</span>
        <span class="n">df</span><span class="p">,</span>
        <span class="n">truncated_time_col</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_col</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">treatment_col</span><span class="p">,</span>
        <span class="n">cluster_cols</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cluster_cols</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022 Maintained by David Masip.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/david26694/cluster-experiments" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.tabs", "content.code.annotate", "content.code.copy", "navigation.instant", "navigation.tracking", "navigation.top"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
    
  </body>
</html>