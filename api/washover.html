
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Functions to design and run clustered experiments">
      
      
        <meta name="author" content="David Masip">
      
      
        <link rel="canonical" href="https://david26694.github.io/cluster-experiments/api/washover.html">
      
      
        <link rel="prev" href="power_analysis.html">
      
      
        <link rel="next" href="metric.html">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.5">
    
    
      
        <title>Washover - Cluster Experiments Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,300i,400,400i,700,700i%7CUbuntu+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Ubuntu";--md-code-font:"Ubuntu Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../style.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#from-cluster_experimentswashover-import" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Cluster Experiments Docs" class="md-header__button md-logo" aria-label="Cluster Experiments Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cluster Experiments Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Washover
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/david26694/cluster-experiments" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Cluster Experiments Docs" class="md-nav__button md-logo" aria-label="Cluster Experiments Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Cluster Experiments Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/david26694/cluster-experiments" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Home
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../e2e_mde.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    End-to-end example
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cupac_example.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cupac example
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../create_custom_classes.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom classes
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Switchback
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Switchback
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../switchback.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Stratified switchback
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plot_calendars.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Switchback calendar visualization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plot_calendars_hours.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Visualization - 4-hour switches
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../e2e_mde_switchback.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    End-to-end example
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../multivariate.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multiple treatments
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../aa_test.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AA test clustered
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../paired_ttest.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Paired T test
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../analysis_with_different_hypotheses.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Power comparison under different hypotheses
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../washover_example.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Washover
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Normal Power
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            Normal Power
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../normal_power.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Compare with simulation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../normal_power_lines.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Time-lines
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../synthetic_control.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Synthetic Control
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../experiment_analysis.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Experiment Analysis
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14" >
        
          
          <label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Delta method
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_14">
            <span class="md-nav__icon md-icon"></span>
            Delta method
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../delta_method.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Delta Method Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../e2e_mde_delta.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    End-to-end example
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15" checked>
        
          
          <label class="md-nav__link" for="__nav_15" id="__nav_15_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_15_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_15">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="experiment_analysis.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Experiment analysis methods
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="perturbator.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Perturbators
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="random_splitter.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Splitter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="cupac_model.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pre experiment outcome model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="power_config.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Power config
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="power_analysis.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Power analysis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Washover
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="washover.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Washover
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.washover" class="md-nav__link">
    <span class="md-ellipsis">
      washover
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.washover.ConstantWashover" class="md-nav__link">
    <span class="md-ellipsis">
      ConstantWashover
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ConstantWashover">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.washover.ConstantWashover.washover" class="md-nav__link">
    <span class="md-ellipsis">
      washover
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.washover.EmptyWashover" class="md-nav__link">
    <span class="md-ellipsis">
      EmptyWashover
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EmptyWashover">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.washover.EmptyWashover.washover" class="md-nav__link">
    <span class="md-ellipsis">
      washover
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.washover.Washover" class="md-nav__link">
    <span class="md-ellipsis">
      Washover
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Washover">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.washover.Washover._validate_columns" class="md-nav__link">
    <span class="md-ellipsis">
      _validate_columns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.washover.Washover.washover" class="md-nav__link">
    <span class="md-ellipsis">
      washover
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="metric.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Metric
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="variant.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Variant
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="dimension.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dimension
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="hypothesis_test.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hypothesis Test
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="analysis_plan.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Analysis Plan
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.washover" class="md-nav__link">
    <span class="md-ellipsis">
      washover
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.washover.ConstantWashover" class="md-nav__link">
    <span class="md-ellipsis">
      ConstantWashover
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ConstantWashover">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.washover.ConstantWashover.washover" class="md-nav__link">
    <span class="md-ellipsis">
      washover
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.washover.EmptyWashover" class="md-nav__link">
    <span class="md-ellipsis">
      EmptyWashover
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EmptyWashover">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.washover.EmptyWashover.washover" class="md-nav__link">
    <span class="md-ellipsis">
      washover
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cluster_experiments.washover.Washover" class="md-nav__link">
    <span class="md-ellipsis">
      Washover
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Washover">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.washover.Washover._validate_columns" class="md-nav__link">
    <span class="md-ellipsis">
      _validate_columns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cluster_experiments.washover.Washover.washover" class="md-nav__link">
    <span class="md-ellipsis">
      washover
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="from-cluster_experimentswashover-import"><code>from cluster_experiments.washover import *</code><a class="headerlink" href="#from-cluster_experimentswashover-import" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">



<a id="cluster_experiments.washover"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="cluster_experiments.washover.ConstantWashover" class="doc doc-heading">
            <code>ConstantWashover</code>


<a href="#cluster_experiments.washover.ConstantWashover" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="cluster_experiments.washover.Washover" href="#cluster_experiments.washover.Washover">Washover</a></code></p>


        <p>Constant washover - we drop all rows in the washover period when
there is a switch where the treatment is different.</p>






              <details class="quote">
                <summary>Source code in <code>cluster_experiments/washover.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ConstantWashover</span><span class="p">(</span><span class="n">Washover</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constant washover - we drop all rows in the washover period when</span>
<span class="sd">    there is a switch where the treatment is different.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">washover_time_delta</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">washover_time_delta</span> <span class="o">=</span> <span class="n">washover_time_delta</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">washover</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">truncated_time_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">cluster_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">original_time_col</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constant washover - we drop all rows in the washover period when</span>
<span class="sd">        there is a switch where the treatment is different.</span>

<span class="sd">        Args:</span>
<span class="sd">            df (pd.DataFrame): Input dataframe.</span>
<span class="sd">            truncated_time_col (str): Name of the truncated time column.</span>
<span class="sd">            treatment_col (str): Name of the treatment column.</span>
<span class="sd">            cluster_cols (List[str]): List of clusters of experiment.</span>
<span class="sd">            original_time_col (Optional[str], optional): Name of the original time column.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: Same dataframe as input without the rows in the washover period.</span>

<span class="sd">        Usage:</span>
<span class="sd">        ```python</span>
<span class="sd">        import numpy as np</span>
<span class="sd">        import pandas as pd</span>
<span class="sd">        from datetime import datetime, timedelta</span>

<span class="sd">        from cluster_experiments import ConstantWashover</span>

<span class="sd">        np.random.seed(42)</span>

<span class="sd">        num_rows = 10</span>

<span class="sd">        def random_timestamp(start_time, end_time):</span>
<span class="sd">            time_delta = end_time - start_time</span>
<span class="sd">            random_seconds = np.random.randint(0, time_delta.total_seconds())</span>
<span class="sd">            return start_time + timedelta(seconds=random_seconds)</span>

<span class="sd">        def generate_data(start_time, end_time, treatment):</span>
<span class="sd">            data = {</span>
<span class="sd">                &#39;order_id&#39;: np.random.randint(10**9, 10**10, size=num_rows),</span>
<span class="sd">                &#39;city_code&#39;: &#39;VAL&#39;,</span>
<span class="sd">                &#39;activation_time_local&#39;: [random_timestamp(start_time, end_time) for _ in range(num_rows)],</span>
<span class="sd">                &#39;bin_start_time_local&#39;: start_time,</span>
<span class="sd">                &#39;treatment&#39;: treatment</span>
<span class="sd">            }</span>
<span class="sd">            return pd.DataFrame(data)</span>

<span class="sd">        start_times = [datetime(2024, 1, 22, 9, 0), datetime(2024, 1, 22, 11, 0),</span>
<span class="sd">                    datetime(2024, 1, 22, 13, 0), datetime(2024, 1, 22, 15, 0)]</span>

<span class="sd">        treatments = [&#39;control&#39;, &#39;variation&#39;, &#39;variation&#39;, &#39;control&#39;]</span>

<span class="sd">        dataframes = [generate_data(start, start + timedelta(hours=2), treatment) for start, treatment in zip(start_times, treatments)]</span>

<span class="sd">        df = pd.concat(dataframes).sort_values(by=&#39;activation_time_local&#39;).reset_index(drop=True)</span>

<span class="sd">        ## Define washover with 30 min duration</span>
<span class="sd">        washover = ConstantWashover(washover_time_delta=timedelta(minutes=30))</span>

<span class="sd">        ## Apply washover to the dataframe, the orders with activation time within the first 30 minutes after every change in the treatment column, clustering by city and 2h time bin, will be dropped</span>
<span class="sd">        df_analysis_washover = washover.washover(</span>
<span class="sd">            df=df,</span>
<span class="sd">            truncated_time_col=&#39;bin_start_time_local&#39;,</span>
<span class="sd">            treatment_col=&#39;treatment&#39;,</span>
<span class="sd">            cluster_cols=[&#39;city_code&#39;,&#39;bin_start_time_local&#39;],</span>
<span class="sd">            original_time_col=&#39;activation_time_local&#39;,</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Set original time column</span>
        <span class="n">original_time_col</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">original_time_col</span>
            <span class="k">if</span> <span class="n">original_time_col</span>
            <span class="k">else</span> <span class="n">_original_time_column</span><span class="p">(</span><span class="n">truncated_time_col</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Validate columns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_columns</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">truncated_time_col</span><span class="p">,</span> <span class="n">cluster_cols</span><span class="p">,</span> <span class="n">original_time_col</span><span class="p">)</span>

        <span class="c1"># Cluster columns that do not involve time</span>
        <span class="n">non_time_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">cluster_cols</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="n">truncated_time_col</span><span class="p">]))</span>
        <span class="c1"># For each cluster, we need to check if treatment has changed wrt last time</span>
        <span class="n">df_agg</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="n">original_time_col</span><span class="p">])</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">df_agg</span> <span class="o">=</span> <span class="n">df_agg</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">cluster_cols</span> <span class="o">+</span> <span class="p">[</span><span class="n">treatment_col</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">non_time_cols</span><span class="p">:</span>
            <span class="n">df_agg</span><span class="p">[</span><span class="s2">&quot;__changed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">df_agg</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">non_time_cols</span><span class="p">)[</span><span class="n">treatment_col</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="o">!=</span> <span class="n">df_agg</span><span class="p">[</span><span class="n">treatment_col</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df_agg</span><span class="p">[</span><span class="s2">&quot;__changed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">df_agg</span><span class="p">[</span><span class="n">treatment_col</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="n">df_agg</span><span class="p">[</span><span class="n">treatment_col</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="n">df_agg</span> <span class="o">=</span> <span class="n">df_agg</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">cluster_cols</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;__changed&quot;</span><span class="p">]]</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_agg</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">cluster_cols</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">assign</span><span class="p">(</span>
                <span class="n">__time_since_switch</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">original_time_col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
                    <span class="s2">&quot;datetime64[ns]&quot;</span>
                <span class="p">)</span>
                <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">truncated_time_col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;datetime64[ns]&quot;</span><span class="p">),</span>
                <span class="n">__after_washover</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;__time_since_switch&quot;</span><span class="p">]</span>
                <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">washover_time_delta</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># add not changed in query</span>
            <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;__after_washover or not __changed&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;__time_since_switch&quot;</span><span class="p">,</span> <span class="s2">&quot;__after_washover&quot;</span><span class="p">,</span> <span class="s2">&quot;__changed&quot;</span><span class="p">])</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Washover&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">washover_time_delta</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Washover time delta must be specified for ConstantWashover, while it is </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">washover_time_delta</span><span class="w"> </span><span class="si">= }</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">washover_time_delta</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">washover_time_delta</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">washover_time_delta</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">washover_time_delta</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">washover_time_delta</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">washover_time_delta</span><span class="o">=</span><span class="n">washover_time_delta</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.washover.ConstantWashover.washover" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">washover</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">truncated_time_col</span><span class="p">,</span> <span class="n">treatment_col</span><span class="p">,</span> <span class="n">cluster_cols</span><span class="p">,</span> <span class="n">original_time_col</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#cluster_experiments.washover.ConstantWashover.washover" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Constant washover - we drop all rows in the washover period when
there is a switch where the treatment is different.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input dataframe.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>truncated_time_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the truncated time column.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>treatment_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the treatment column.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cluster_cols</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of clusters of experiment.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>original_time_col</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the original time column.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: Same dataframe as input without the rows in the washover period.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Usage:
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">cluster_experiments</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConstantWashover</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="n">num_rows</span> <span class="o">=</span> <span class="mi">10</span>

<span class="k">def</span><span class="w"> </span><span class="nf">random_timestamp</span><span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">):</span>
    <span class="n">time_delta</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
    <span class="n">random_seconds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">time_delta</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">start_time</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">random_seconds</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">generate_data</span><span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">,</span> <span class="n">treatment</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;order_id&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">10</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">num_rows</span><span class="p">),</span>
        <span class="s1">&#39;city_code&#39;</span><span class="p">:</span> <span class="s1">&#39;VAL&#39;</span><span class="p">,</span>
        <span class="s1">&#39;activation_time_local&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">random_timestamp</span><span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_rows</span><span class="p">)],</span>
        <span class="s1">&#39;bin_start_time_local&#39;</span><span class="p">:</span> <span class="n">start_time</span><span class="p">,</span>
        <span class="s1">&#39;treatment&#39;</span><span class="p">:</span> <span class="n">treatment</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">start_times</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>

<span class="n">treatments</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;control&#39;</span><span class="p">,</span> <span class="s1">&#39;variation&#39;</span><span class="p">,</span> <span class="s1">&#39;variation&#39;</span><span class="p">,</span> <span class="s1">&#39;control&#39;</span><span class="p">]</span>

<span class="n">dataframes</span> <span class="o">=</span> <span class="p">[</span><span class="n">generate_data</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">start</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">treatment</span><span class="p">)</span> <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">treatment</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">start_times</span><span class="p">,</span> <span class="n">treatments</span><span class="p">)]</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dataframes</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;activation_time_local&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">## Define washover with 30 min duration</span>
<span class="n">washover</span> <span class="o">=</span> <span class="n">ConstantWashover</span><span class="p">(</span><span class="n">washover_time_delta</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">30</span><span class="p">))</span>

<span class="c1">## Apply washover to the dataframe, the orders with activation time within the first 30 minutes after every change in the treatment column, clustering by city and 2h time bin, will be dropped</span>
<span class="n">df_analysis_washover</span> <span class="o">=</span> <span class="n">washover</span><span class="o">.</span><span class="n">washover</span><span class="p">(</span>
    <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <span class="n">truncated_time_col</span><span class="o">=</span><span class="s1">&#39;bin_start_time_local&#39;</span><span class="p">,</span>
    <span class="n">treatment_col</span><span class="o">=</span><span class="s1">&#39;treatment&#39;</span><span class="p">,</span>
    <span class="n">cluster_cols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;city_code&#39;</span><span class="p">,</span><span class="s1">&#39;bin_start_time_local&#39;</span><span class="p">],</span>
    <span class="n">original_time_col</span><span class="o">=</span><span class="s1">&#39;activation_time_local&#39;</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div></p>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/washover.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">washover</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">truncated_time_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">treatment_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">cluster_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">original_time_col</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constant washover - we drop all rows in the washover period when</span>
<span class="sd">    there is a switch where the treatment is different.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): Input dataframe.</span>
<span class="sd">        truncated_time_col (str): Name of the truncated time column.</span>
<span class="sd">        treatment_col (str): Name of the treatment column.</span>
<span class="sd">        cluster_cols (List[str]): List of clusters of experiment.</span>
<span class="sd">        original_time_col (Optional[str], optional): Name of the original time column.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: Same dataframe as input without the rows in the washover period.</span>

<span class="sd">    Usage:</span>
<span class="sd">    ```python</span>
<span class="sd">    import numpy as np</span>
<span class="sd">    import pandas as pd</span>
<span class="sd">    from datetime import datetime, timedelta</span>

<span class="sd">    from cluster_experiments import ConstantWashover</span>

<span class="sd">    np.random.seed(42)</span>

<span class="sd">    num_rows = 10</span>

<span class="sd">    def random_timestamp(start_time, end_time):</span>
<span class="sd">        time_delta = end_time - start_time</span>
<span class="sd">        random_seconds = np.random.randint(0, time_delta.total_seconds())</span>
<span class="sd">        return start_time + timedelta(seconds=random_seconds)</span>

<span class="sd">    def generate_data(start_time, end_time, treatment):</span>
<span class="sd">        data = {</span>
<span class="sd">            &#39;order_id&#39;: np.random.randint(10**9, 10**10, size=num_rows),</span>
<span class="sd">            &#39;city_code&#39;: &#39;VAL&#39;,</span>
<span class="sd">            &#39;activation_time_local&#39;: [random_timestamp(start_time, end_time) for _ in range(num_rows)],</span>
<span class="sd">            &#39;bin_start_time_local&#39;: start_time,</span>
<span class="sd">            &#39;treatment&#39;: treatment</span>
<span class="sd">        }</span>
<span class="sd">        return pd.DataFrame(data)</span>

<span class="sd">    start_times = [datetime(2024, 1, 22, 9, 0), datetime(2024, 1, 22, 11, 0),</span>
<span class="sd">                datetime(2024, 1, 22, 13, 0), datetime(2024, 1, 22, 15, 0)]</span>

<span class="sd">    treatments = [&#39;control&#39;, &#39;variation&#39;, &#39;variation&#39;, &#39;control&#39;]</span>

<span class="sd">    dataframes = [generate_data(start, start + timedelta(hours=2), treatment) for start, treatment in zip(start_times, treatments)]</span>

<span class="sd">    df = pd.concat(dataframes).sort_values(by=&#39;activation_time_local&#39;).reset_index(drop=True)</span>

<span class="sd">    ## Define washover with 30 min duration</span>
<span class="sd">    washover = ConstantWashover(washover_time_delta=timedelta(minutes=30))</span>

<span class="sd">    ## Apply washover to the dataframe, the orders with activation time within the first 30 minutes after every change in the treatment column, clustering by city and 2h time bin, will be dropped</span>
<span class="sd">    df_analysis_washover = washover.washover(</span>
<span class="sd">        df=df,</span>
<span class="sd">        truncated_time_col=&#39;bin_start_time_local&#39;,</span>
<span class="sd">        treatment_col=&#39;treatment&#39;,</span>
<span class="sd">        cluster_cols=[&#39;city_code&#39;,&#39;bin_start_time_local&#39;],</span>
<span class="sd">        original_time_col=&#39;activation_time_local&#39;,</span>
<span class="sd">    )</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set original time column</span>
    <span class="n">original_time_col</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">original_time_col</span>
        <span class="k">if</span> <span class="n">original_time_col</span>
        <span class="k">else</span> <span class="n">_original_time_column</span><span class="p">(</span><span class="n">truncated_time_col</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Validate columns</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_columns</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">truncated_time_col</span><span class="p">,</span> <span class="n">cluster_cols</span><span class="p">,</span> <span class="n">original_time_col</span><span class="p">)</span>

    <span class="c1"># Cluster columns that do not involve time</span>
    <span class="n">non_time_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">cluster_cols</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="n">truncated_time_col</span><span class="p">]))</span>
    <span class="c1"># For each cluster, we need to check if treatment has changed wrt last time</span>
    <span class="n">df_agg</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="n">original_time_col</span><span class="p">])</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">df_agg</span> <span class="o">=</span> <span class="n">df_agg</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">cluster_cols</span> <span class="o">+</span> <span class="p">[</span><span class="n">treatment_col</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">non_time_cols</span><span class="p">:</span>
        <span class="n">df_agg</span><span class="p">[</span><span class="s2">&quot;__changed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">df_agg</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">non_time_cols</span><span class="p">)[</span><span class="n">treatment_col</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="o">!=</span> <span class="n">df_agg</span><span class="p">[</span><span class="n">treatment_col</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df_agg</span><span class="p">[</span><span class="s2">&quot;__changed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">df_agg</span><span class="p">[</span><span class="n">treatment_col</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="n">df_agg</span><span class="p">[</span><span class="n">treatment_col</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="n">df_agg</span> <span class="o">=</span> <span class="n">df_agg</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">cluster_cols</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;__changed&quot;</span><span class="p">]]</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_agg</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">cluster_cols</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">assign</span><span class="p">(</span>
            <span class="n">__time_since_switch</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">original_time_col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
                <span class="s2">&quot;datetime64[ns]&quot;</span>
            <span class="p">)</span>
            <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">truncated_time_col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;datetime64[ns]&quot;</span><span class="p">),</span>
            <span class="n">__after_washover</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;__time_since_switch&quot;</span><span class="p">]</span>
            <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">washover_time_delta</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># add not changed in query</span>
        <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;__after_washover or not __changed&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;__time_since_switch&quot;</span><span class="p">,</span> <span class="s2">&quot;__after_washover&quot;</span><span class="p">,</span> <span class="s2">&quot;__changed&quot;</span><span class="p">])</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cluster_experiments.washover.EmptyWashover" class="doc doc-heading">
            <code>EmptyWashover</code>


<a href="#cluster_experiments.washover.EmptyWashover" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="cluster_experiments.washover.Washover" href="#cluster_experiments.washover.Washover">Washover</a></code></p>


        <p>No washover - assumes no spill-over effects from one treatment to another.</p>






              <details class="quote">
                <summary>Source code in <code>cluster_experiments/washover.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">EmptyWashover</span><span class="p">(</span><span class="n">Washover</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;No washover - assumes no spill-over effects from one treatment to another.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">washover</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">truncated_time_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">cluster_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">original_time_col</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;No washover - returns the same dataframe as input.</span>

<span class="sd">        Args:</span>
<span class="sd">            df (pd.DataFrame): Input dataframe.</span>
<span class="sd">            truncated_time_col (str): Name of the truncated time column.</span>
<span class="sd">            treatment_col (str): Name of the treatment column.</span>
<span class="sd">            cluster_cols (List[str]): List of clusters of experiment.</span>
<span class="sd">            original_time_col (Optional[str], optional): Name of the original time column.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: Same dataframe as input.</span>

<span class="sd">        Usage:</span>
<span class="sd">        ```python</span>
<span class="sd">        from cluster_experiments import SwitchbackSplitter</span>
<span class="sd">        from cluster_experiments import EmptyWashover</span>

<span class="sd">        washover = EmptyWashover()</span>

<span class="sd">        n = 10</span>
<span class="sd">        df = pd.DataFrame(</span>
<span class="sd">            {</span>
<span class="sd">                # Random time each minute in 2022-01-01, length 10</span>
<span class="sd">                &quot;time&quot;: pd.date_range(&quot;2022-01-01&quot;, &quot;2022-01-02&quot;, freq=&quot;1min&quot;)[</span>
<span class="sd">                    np.random.randint(24 * 60, size=n)</span>
<span class="sd">                ],</span>
<span class="sd">                &quot;city&quot;: random.choices([&quot;TGN&quot;, &quot;NYC&quot;, &quot;LON&quot;, &quot;REU&quot;], k=n),</span>
<span class="sd">            }</span>
<span class="sd">        )</span>


<span class="sd">        splitter = SwitchbackSplitter(</span>
<span class="sd">            washover=washover,</span>
<span class="sd">            time_col=&quot;time&quot;,</span>
<span class="sd">            cluster_cols=[&quot;city&quot;, &quot;time&quot;],</span>
<span class="sd">            treatment_col=&quot;treatment&quot;,</span>
<span class="sd">            switch_frequency=&quot;30T&quot;,</span>
<span class="sd">        )</span>

<span class="sd">        out_df = splitter.assign_treatment_df(df=washover_split_df)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.washover.EmptyWashover.washover" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">washover</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">truncated_time_col</span><span class="p">,</span> <span class="n">treatment_col</span><span class="p">,</span> <span class="n">cluster_cols</span><span class="p">,</span> <span class="n">original_time_col</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#cluster_experiments.washover.EmptyWashover.washover" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>No washover - returns the same dataframe as input.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input dataframe.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>truncated_time_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the truncated time column.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>treatment_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the treatment column.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cluster_cols</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of clusters of experiment.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>original_time_col</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the original time column.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: Same dataframe as input.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Usage:
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">cluster_experiments</span><span class="w"> </span><span class="kn">import</span> <span class="n">SwitchbackSplitter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cluster_experiments</span><span class="w"> </span><span class="kn">import</span> <span class="n">EmptyWashover</span>

<span class="n">washover</span> <span class="o">=</span> <span class="n">EmptyWashover</span><span class="p">()</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="c1"># Random time each minute in 2022-01-01, length 10</span>
        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">&quot;2022-01-01&quot;</span><span class="p">,</span> <span class="s2">&quot;2022-01-02&quot;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;1min&quot;</span><span class="p">)[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
        <span class="p">],</span>
        <span class="s2">&quot;city&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">([</span><span class="s2">&quot;TGN&quot;</span><span class="p">,</span> <span class="s2">&quot;NYC&quot;</span><span class="p">,</span> <span class="s2">&quot;LON&quot;</span><span class="p">,</span> <span class="s2">&quot;REU&quot;</span><span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="n">n</span><span class="p">),</span>
    <span class="p">}</span>
<span class="p">)</span>


<span class="n">splitter</span> <span class="o">=</span> <span class="n">SwitchbackSplitter</span><span class="p">(</span>
    <span class="n">washover</span><span class="o">=</span><span class="n">washover</span><span class="p">,</span>
    <span class="n">time_col</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span>
    <span class="n">cluster_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;city&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">],</span>
    <span class="n">treatment_col</span><span class="o">=</span><span class="s2">&quot;treatment&quot;</span><span class="p">,</span>
    <span class="n">switch_frequency</span><span class="o">=</span><span class="s2">&quot;30T&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">out_df</span> <span class="o">=</span> <span class="n">splitter</span><span class="o">.</span><span class="n">assign_treatment_df</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">washover_split_df</span><span class="p">)</span>
</code></pre></div></p>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/washover.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">washover</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">truncated_time_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">treatment_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">cluster_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">original_time_col</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;No washover - returns the same dataframe as input.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): Input dataframe.</span>
<span class="sd">        truncated_time_col (str): Name of the truncated time column.</span>
<span class="sd">        treatment_col (str): Name of the treatment column.</span>
<span class="sd">        cluster_cols (List[str]): List of clusters of experiment.</span>
<span class="sd">        original_time_col (Optional[str], optional): Name of the original time column.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: Same dataframe as input.</span>

<span class="sd">    Usage:</span>
<span class="sd">    ```python</span>
<span class="sd">    from cluster_experiments import SwitchbackSplitter</span>
<span class="sd">    from cluster_experiments import EmptyWashover</span>

<span class="sd">    washover = EmptyWashover()</span>

<span class="sd">    n = 10</span>
<span class="sd">    df = pd.DataFrame(</span>
<span class="sd">        {</span>
<span class="sd">            # Random time each minute in 2022-01-01, length 10</span>
<span class="sd">            &quot;time&quot;: pd.date_range(&quot;2022-01-01&quot;, &quot;2022-01-02&quot;, freq=&quot;1min&quot;)[</span>
<span class="sd">                np.random.randint(24 * 60, size=n)</span>
<span class="sd">            ],</span>
<span class="sd">            &quot;city&quot;: random.choices([&quot;TGN&quot;, &quot;NYC&quot;, &quot;LON&quot;, &quot;REU&quot;], k=n),</span>
<span class="sd">        }</span>
<span class="sd">    )</span>


<span class="sd">    splitter = SwitchbackSplitter(</span>
<span class="sd">        washover=washover,</span>
<span class="sd">        time_col=&quot;time&quot;,</span>
<span class="sd">        cluster_cols=[&quot;city&quot;, &quot;time&quot;],</span>
<span class="sd">        treatment_col=&quot;treatment&quot;,</span>
<span class="sd">        switch_frequency=&quot;30T&quot;,</span>
<span class="sd">    )</span>

<span class="sd">    out_df = splitter.assign_treatment_df(df=washover_split_df)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="cluster_experiments.washover.Washover" class="doc doc-heading">
            <code>Washover</code>


<a href="#cluster_experiments.washover.Washover" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>Abstract class to model washovers in the switchback splitter.</p>






              <details class="quote">
                <summary>Source code in <code>cluster_experiments/washover.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Washover</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract class to model washovers in the switchback splitter.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_columns</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">truncated_time_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">cluster_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">original_time_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate that all the columns required for the washover are present in the dataframe.</span>

<span class="sd">        Args:</span>
<span class="sd">            df (pd.DataFrame): Input dataframe.</span>
<span class="sd">            truncated_time_col (str): Name of the truncated time column.</span>
<span class="sd">            cluster_cols (List[str]): List of clusters of experiment.</span>
<span class="sd">            original_time_col (str): Name of the original time column.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None: This method does not return any data; it only performs validation.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">original_time_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">original_time_col</span><span class="w"> </span><span class="si">= }</span><span class="s2"> is not in the dataframe columns and/or not specified as an input.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">truncated_time_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cluster_cols</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">truncated_time_col</span><span class="w"> </span><span class="si">= }</span><span class="s2"> is not in the cluster columns.&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cluster_cols</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="w"> </span><span class="si">= }</span><span class="s2"> cluster is not in the dataframe columns.&quot;</span><span class="p">)</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">washover</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">truncated_time_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">treatment_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">cluster_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">original_time_col</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Abstract method to add washvover to the dataframe.&quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Washover&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.washover.Washover._validate_columns" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_validate_columns</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">truncated_time_col</span><span class="p">,</span> <span class="n">cluster_cols</span><span class="p">,</span> <span class="n">original_time_col</span><span class="p">)</span></code>

<a href="#cluster_experiments.washover.Washover._validate_columns" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Validate that all the columns required for the washover are present in the dataframe.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input dataframe.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>truncated_time_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the truncated time column.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cluster_cols</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of clusters of experiment.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>original_time_col</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the original time column.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>None</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>This method does not return any data; it only performs validation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/washover.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_validate_columns</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">truncated_time_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">cluster_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">original_time_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate that all the columns required for the washover are present in the dataframe.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): Input dataframe.</span>
<span class="sd">        truncated_time_col (str): Name of the truncated time column.</span>
<span class="sd">        cluster_cols (List[str]): List of clusters of experiment.</span>
<span class="sd">        original_time_col (str): Name of the original time column.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None: This method does not return any data; it only performs validation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">original_time_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">original_time_col</span><span class="w"> </span><span class="si">= }</span><span class="s2"> is not in the dataframe columns and/or not specified as an input.&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">truncated_time_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cluster_cols</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">truncated_time_col</span><span class="w"> </span><span class="si">= }</span><span class="s2"> is not in the cluster columns.&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cluster_cols</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="w"> </span><span class="si">= }</span><span class="s2"> cluster is not in the dataframe columns.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cluster_experiments.washover.Washover.washover" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">washover</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">truncated_time_col</span><span class="p">,</span> <span class="n">treatment_col</span><span class="p">,</span> <span class="n">cluster_cols</span><span class="p">,</span> <span class="n">original_time_col</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#cluster_experiments.washover.Washover.washover" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Abstract method to add washvover to the dataframe.</p>

            <details class="quote">
              <summary>Source code in <code>cluster_experiments/washover.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">washover</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">truncated_time_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">treatment_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">cluster_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">original_time_col</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract method to add washvover to the dataframe.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022 Maintained by David Masip.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
    
  </body>
</html>